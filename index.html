<!DOCTYPE  html>
<html lang="en">
   <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TemplateFx | Dynamic Templating Tool</title>
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAQQSURBVHic7dyhbmJ5HIbh32x6AZjKJlW1rVzZ3kQvsjcwsthx1I2ZhKR2BWLFyDVju9sdoAf6Po8+h3z8Ia8gwAwAAAAAAAAAAAAAAAAAAHCivux19/X9ambuDjOFM7KZ7Xq39Aj2d7Hn/Xdz+/g8q6uDjOEM7F5nXp4eZma99BT2t28AZlZXM5c3B5gCfLQ/lh4ALEcAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIEwAIOxi6QF8Ytf3q5m5W3rGB9vMdr1besR7CQDHdDe3j8+zulp6x8fYvc68PD3MzHrpKe8lABzX6mrm8mbpFbzBZwAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQJgAQdrH3I+xeDzCDs/F/X+/S++MMn+u+AdjMy9PDQZZwTjbvvq73/njv2QAAAAAAAAAAABzGl6UHnKzr+9XM3C0940RtZrve/edVzvAj7Ga7/u1vH+7/W4DP625uH59ndbX0jtOye51fX+9dv+NqZ3hs379+m+36z9+9XQD+zepq5vJm6RXnzRke14/nn/vc7ufAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAECYAEHax9ICTtntdesHpcSafigC8bTMvTw9LjzhRm6UHcBgC8Jbtejcz66VnwDH5DADCBADCBADCBADCBADCBADCBADCBADCBADCBADCBADCBADCBADCBADCBADCBADC/CEIx7Sb71+/zY/nn0sP+bT+/mu79AQAAAAAAAAAAAAAAAAAAOAo/gG0Q06Sc9TFagAAAABJRU5ErkJggg==">
    <style type="text/css">
      html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{font-size:2em;margin:0.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}*:before,*:after{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}input,button,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#428bca;text-decoration:none}a:hover,a:focus{color:#2a6496;text-decoration:underline}a:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.img-responsive{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:all .2s ease-in-out;transition:all .2s ease-in-out;display:inline-block;max-width:100%;height:auto}.img-circle{border-radius:50%}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;margin:-1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);border:0}
      code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Courier New",monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;white-space:wrap;border-radius:4px}kbd{padding:2px 4px;font-size:90%;color:#fff;background-color:#333;border-radius:3px;box-shadow:inset 0 -1px 0 rgba(0,0,0,0.25)}pre{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;word-break:break-all;word-wrap:break-word;color:#333;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.pre-scrollable{max-height:340px;overflow-y:scroll}
      .label{display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:bold;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}.label[href]:hover,.label[href]:focus{color:#fff;text-decoration:none;cursor:pointer}.label:empty{display:none}.btn .label{position:relative;top:-1px}.label-default{background-color:#999}.label-default[href]:hover,.label-default[href]:focus{background-color:#808080}.label-primary{background-color:#428bca}.label-primary[href]:hover,.label-primary[href]:focus{background-color:#3071a9}.label-success{background-color:#5cb85c}.label-success[href]:hover,.label-success[href]:focus{background-color:#449d44}.label-info{background-color:#5bc0de}.label-info[href]:hover,.label-info[href]:focus{background-color:#31b0d5}.label-warning{background-color:#f0ad4e}.label-warning[href]:hover,.label-warning[href]:focus{background-color:#ec971f}.label-danger{background-color:#d9534f}.label-danger[href]:hover,.label-danger[href]:focus{background-color:#c9302c}
      html { margin: 10px; font-family: Calibri, Geneva, sans-serif; text-align: left; }
      div.content { width: 90% }
      div.title h3 { margin-top: 5px; margin-bottom: 0px }
      div.title h4 { margin-top: 0px }
      th, td { white-space: nowrap; padding: 2px }
      img.screenshot { width: 30% }
      h4.heading { color: #4169e1 }
      span { display: inline-block }
      span.if { background: #ee82ee }
      span.for { background: #c0a172 }
      span.field { background: #adff2f }
      span.input { background: #c3adff }
      span.input_type { background: #ee82ee }
      span.script { background: #ffc800 }
      span.comment { background: #99ccff }
      span.marker { background: #33b8ff }       
      span.group { background: #11ccaa }
      span.at { background: #ff7f50 }
      .inline-left { text-align: left }
      .inline-center { text-align: center }
      .block-center { margin-left: auto; margin-right: auto }
    </style>
  </head>
  <body>
    <div class="content block-center">
      <div class="title inline-center">
        <svg width="64" height="64" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <rect x="32" y="32" width="250" height="250" fill="#0074d9" stroke="#001f3f" />
          <rect x="304" y="162" width="120" height="120" fill="#0074d9" stroke="#001f3f" />
          <rect x="142" y="304" width="140" height="140" fill="#0074d9" stroke="#001f3f" />
          <rect x="304" y="304" width="177" height="177" fill="#0074d9" stroke="#001f3f" />
        </svg>
        <h3>TemplateFx | Dynamic Templating Tool</h3>
        <h4>by Chris Mason &lt;<a href="mailto:chris@templatefx.org">chris@templatefx.org</a>&gt;</h4>
        
        <h4>Latest TemplateFx Server v3.3.0 (Build 19176)<br />Released: 25th June 2019</h4>
        <h4>Latest TemplateFx GUI v3.2.0 (Build 19167)<br />Released: 16th June 2019</h4>
      </div>

      <p>I have had a couple of requests to provide a "donate" type link for people to show their appreciation - I don't charge anything for you to use TemplateFx and I never will, but if you use TemplateFx and find it useful and want to show your appreciation then you can using <a href="https://paypal.me/chrixm">https://paypal.me/chrixm</a>.</p>
       
      <h4 class="heading">1. Introduction</h4>

      <p>TemplateFx is a Dynamic Templating Tool which allows you to generate outputs based on a template and some source data. Its main use is in generating configurations for CLI based devices like routers, switches, firewalls, etc. It aims to be portable and platform independent through the use of Java and as such requires a Java Runtime Environment (JRE) of at least version 8 to be installed.</p>

      <p>TemplateFx consists of two separate components - the TemplateFx GUI client and the GUI-less TemplateFx Server which contains just the core templating engine accessible through a REST API. The majority of this document is written with the GUI client in mind as a lot of the templating syntax is the same (where things are only supported in the GUI client they are marked with <span class="label label-danger">GUI Only</span>). However, a section has been added at the end which provides some detailed usage around the TemplateFx Server.</p>

      <p>This document aims to be short as there isn't really a lot to talk about, due to the simplicity of TemplateFx and its hopeful ease of use. However, if you feel something could be made easier or simpler then feedback is welcomed using the email address above.</p>

      <p>Download links for TemplateFx can be found on GitHub at the following location: <a href="https://github.com/chrixm/templatefx/releases" target="_blank">https://github.com/chrixm/templatefx/releases</a><br />All the changes in this release and previous releases can be found within the detailed <a href="changelog.txt" target="_blank">CHANGELOG</a>.</p>
      
      <h4 class="heading">2. User Interface</h4>

      <p>The TemplateFx user interface consists of the "Console", "IP Calc" and "DataTemplate" tabs and multiple "Output" tabs. The "Console" tab is where STDOUT/STDERR goes and where all console logging is sent. The "IP Calc" tab provides easy access to an IPv4/IPv6 Subnet Calculator with support for DNS resolution of subnets, the "DataTemplate" tab is the main tab where you compose your template and the "Output" tabs are where you see your merged data after clicking on the "Generate Output" button on the toolbar.</p>

      <div class="inline-center">
        <a href="/images/templatefx-screenshot1.png" target="_blank"><img class="screenshot" src="/images/templatefx-screenshot1.png" alt="templatefx-screenshot1.png"></a>&nbsp;&nbsp;&nbsp;
        <a href="/images/templatefx-screenshot2.png" target="_blank"><img class="screenshot" src="/images/templatefx-screenshot2.png" alt="templatefx-screenshot2.png"></a>&nbsp;&nbsp;&nbsp;
        <a href="/images/templatefx-screenshot3.png" target="_blank"><img class="screenshot" src="/images/templatefx-screenshot3.png" alt="templatefx-screenshot3.png"></a>
      </div>

      <p>You have the ability to right click on the various panes to allow you to copy and paste or perform other normal operations. As well as the "File" menu to load and save content, you also have the ability to drag and drop data files and template files into the respective panes.</p>

      <p>The "Group By" list allows you to select one or more of your data fields (using CTRL/&#8984; while clicking to select or deselect entries) to allow grouping of your output data. As an example, if you have configuration that needs to be applied to different interfaces on a series of routers, then you could use this to group by your router identifier and interface identifier, to allow you to group interfaces for the same router in the same output. There is also support for splitting an output into multiple outputs using advanced <code>GROUP</code> syntax that is explained in the "Grouping and Merging" section.</p>

      <h4 class="heading">2.1. Data Pane</h4>

      <p>The data pane is where you enter your raw data that TemplateFx will use within your template. Text that is inserted into the data pane has a couple of restrictions that must be followed:</p>

      <ol>
        <li><p>Data is entered in rows and columns, with the columns separated by tabs or commas - you can't mix and match. In the same sense if you click on "Import Data" from the "File" menu then it expects tab or comma separated data.</p></li>
        <li><p>You must define at least two rows within your data. The first row is considered the header row which allows TemplateFx to map the substitution fields in your template to the data. The only exception, is if you haven't used any template fields within the template plane - this is to support situations where you are just using the template pane and in this unusual situation you may leave the data pane blank.</p></li>
      </ol>

      <p>A nice feature of TemplateFx is its ability to accept data from Microsoft Excel. If you construct your data within Excel then you are able to copy and paste it into the data pane. This is the preferred method of constructing source data as you are able to manipulate and sort the data before pasting it into TemplateFx - however be aware of Excel dropping leading zeroes and converting "x/x/x" syntax into dates by default.</p>

      <p><span class="label label-info">NOTE</span>&nbsp;You will get a warning message if the data pane contains a <code>"</code>, <code>'</code> or <code>\</code> character. This is because TemplateFx doesn't keep track in which context the template fields are being inserted - it could be within the main body of the template or within a dynamic script block within an already quoted string. In some contexts, those characters may need to be escaped (e.g. <code>&lt;? print("&lt;&lt;FIELD&gt;&gt;") ?&gt;</code> when there is already a double quote in the value of <code>&lt;&lt;FIELD&gt;&gt;</code>), and in some they might not. If you aren't using those template fields in a scenario (generally a script block) which might cause a problem then you can ignore this warning.</p>
      
      <h4 class="heading">2.2. Template Pane</h4>

      <p>The template pane is where you enter the text of your template that will be used as the basis for your output. TemplateFx fields are defined through the use of double chevrons (e.g. <code>&lt;&lt;FIELD&gt;&gt;</code>) and once you define them within the template pane, they are added to the "Template Fields" list (fields are highlighted in red if they don't exist in the data pane). When you click on the "Generate Output" button, the fields will be substituted for the values in the source data. In the "Generate Output" dialog you have the option of specifying a label for the output tab.</p>
      
      <p>In the event that a template field hasn't been defined within the source data then you will get a warning message as well as it being highlighted in the output to allow you to easily identify it.</p>

      <h4 class="heading">2.3. Output Pane</h4>

      <p>Every time you click on the "Generate Output" button a new output pane is added as a new tab. This pane allows you to see the merged output with the ability to save it or to zip multiple outputs together into a single archive. If you have selected a field in the "Group By" drop down, then you have the ability to cycle through the different output groups. In the event that TemplateFx detects you are creating a HTML based template (i.e. if it detects <code>&lt!DOCTYPE html&gt</code> at the start of your template and then <code>&lt;html&gt;</code> and <code>&lt;/html&gt;</code> tags) then it will give you the option of showing the output in your default browser using the "In Browser" button.</p>

      <p>You also have various different selection options ("Select Line", "Select Block" and "Select Paragraph") by right clicking on the output pane which allows you to easily select blocks to copy. This goes one step further with a feature called "Copy Mode", which is available in the same menu that automatically highlights blocks as you move the mouse over them - this allows you to copy blocks without having to manually select them first.</p>

      <h4 class="heading">2.4. Shortcut Keys</h4>

      <p>TemplateFx defines the following shortcut/accelerator keys that can be used to perform tasks using the keyboard:</p>

      <table class="inline-center">
        <thead>
          <tr>
            <th class="inline-left" style="width: 200px">Action</th>
            <th style="width: 100px">Windows</th>
            <th style="width: 100px">Mac OS</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="inline-left">New</td>
            <td title="Control+N">^N</td>
            <td title="Command+N">&#8984;N</td>
          </tr>
          <tr>
            <td class="inline-left">Load DataTemplate</td>
            <td title="Control+L">^L</td>
            <td title="Command+L">&#8984;L</td>
          </tr>
          <tr>
            <td class="inline-left">Save DataTemplate</td>
            <td title="Control+S">^S</td>
            <td title="Command+S">&#8984;S</td>
          </tr>
          <tr>
            <td class="inline-left">Find and Replace</td>
            <td title="Control+F">^F</td>
            <td title="Command+F">&#8984;F</td>
          </tr>
          <tr>
            <td class="inline-left">Bookmark DataTemplate</td>
            <td title="Control+D">^D</td>
            <td title="Command+D">&#8984;D</td>
          </tr>
          <tr>
            <td class="inline-left">IP Calculator</td>
            <td title="Control+I">^I</td>
            <td title="Command+I">&#8984;I</td>
          </tr>
          <tr>
            <td class="inline-left">Show DataTemplate Pane</td>
            <td title="Control+T">^T</td>
            <td title="Command+T">&#8984;T</td>
          </tr>
          <tr>
            <td class="inline-left">Generate Output</td>
            <td title="Control+G">^G</td>
            <td title="Command+G">&#8984;G</td>
          </tr>
          <tr>
            <td class="inline-left">JavaScript Libraries</td>
            <td title="Control+J">^J</td>
            <td title="Command+J">&#8984;J</td>
          </tr>
          <tr>
            <td class="inline-left">Close Tab</td>
            <td title="Control+W">^W</td>
            <td title="Command+W">&#8984;W</td>
          </tr>
          <tr>
            <td class="inline-left">Help</td>
            <td>F1</td>
            <td>F1</td>
          </tr>
        </tbody>
      </table>

      <h4 class="heading">2.5. Command Line Options (GUI)</h4>

      <dl>
        <dt><strong>-DoI</strong></dt>
        <dd>
          <p>If you have passed TemplateFx an exported DataTemplate as well as this parameter then TemplateFx will treat the file as a temporary file and delete it once it has been loaded (DoI = Delete on Import). This is useful in scenarios where another tool is generating a DataTemplate in a textual format using a temporary file and is then launching TemplateFx in an automated way - this parameter allows TemplateFx to clean up the temporary file once it has been loaded.</>
        </dd>
      </dl>

      <a name="datatemplates"></a>
      <h4 class="heading">3. DataTemplates</h4>

      <p>A DataTemplate is a proprietary file format which uses the file extension ".dt" and is used to store a template along with the source data. Instead of having to distribute the template and source data in separate files, you can save it as a DataTemplate, which combines them both together. Warning: The file format isn't text based and if you attempt to edit it outside of TemplateFx then you will screw up the checksum and it won't load.</p>

      <p>However, you do have the option to export a DataTemplate (and import) in plain text - this will include all aspects of the DataTemplate using specific section blocks to differentiate different aspects. This allows you to edit it outside of TemplateFx and then import it later on. On import you don't need to include all sections (e.g. you can have a file with just some "snippet" blocks), which allows you to merge in additional sections into an existing DataTemplate - on import you have the option to either "Replace" (clear everything first) or "Merge" (will overwrite elements that already exist) the contents of the existing DataTemplate.</p>
      
      <p>The DataTemplate is exported in the following text based format:</p>

      <pre><strong>&lt;templatefx:data&gt;</strong>
DATA
<strong>&lt;/templatefx:data&gt;</strong>

<strong>&lt;templatefx:group_by = </strong>[FIELD_1[ || FIELD_2][ || ...]]<strong> /&gt;</strong>
      
<strong>&lt;templatefx:snippet = </strong>NAME_1<strong>&gt;</strong>
SNIPPET 1
<strong>&lt;/templatefx:snippet&gt;</strong>

<strong>&lt;templatefx:snippet = </strong>NAME_2<strong>&gt;</strong>
SNIPPET 2
<strong>&lt;/templatefx:snippet&gt;</strong>

<strong>&lt;templatefx:template&gt;</strong>
TEMPLATE
<strong>&lt;/templatefx:template&gt;</strong></pre>

      <p>TemplateFx also supports encrypted DataTemplates by selecting "Encrypt DataTemplate" from the "File" menu. After prompting for a password, the DataTemplate will be fully encrypted when it is saved using AES (Advanced Encryption Standard) encryption in CTR mode using a pseudorandom 16 byte IV and a SHA-256 HMAC for integrity which is performed over the salt, IV and ciphertext. The key size is 128 bits (or you can select 256 bits if you have installed the "Java Cryptography Extension Unlimited Strength Jurisdiction Policy Files", unless you are using Java 9 or later where it is enabled by default) and is generated by combining a pseudorandom 64 byte salt with the password using the PBKDF2 (HMAC-SHA-512) key derivation function with 50,000 iterations. Please ensure you don't forget the password as there is no way to decrypt the DataTemplate without it!</p>

      <a name="templates"></a>
      <h4 class="heading">4. Templates</h4>

      <p>To help demonstrate how a template is constructed let us assume we have the following source data defined within our data pane:</p>

      <pre><span class="comment">ROUTER, INTERFACE, IP, DEST</span>
PE-1A, Gi0/0/0, 192.0.2.1, R1 (Gi0/0)
PE-1A, Gi0/0/1, 192.0.2.5, R2 (Gi0/1)
PE-1A, Gi0/0/2, 192.0.2.9, R3 (Gi0/2)</pre>

      <p>We are going to create a template which configures a series of interfaces based on the data provided within the data pane. You can see in the example below that we have used chevrons to mark where we want the substituted data to be placed:</p>

      <pre>interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
 description ## Connection from <span class="field">&lt;&lt;ROUTER&gt;&gt;</span> (<span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>) to <span class="field">&lt;&lt;DEST&gt;&gt;</span> ##
 ip address <span class="field">&lt;&lt;IP&gt;&gt;</span> 255.255.255.252
 no shutdown
!</pre>

      <p>Once you click on "Generate Output", the data within the template pane is effectively duplicated for each line within your source data with the necessary substitutions taking place - it will produce the following output:</p>

      <pre>interface Gi0/0/0
 description ## Connection from PE-1A (Gi0/0/0) to R1 (Gi0/0) ##
 ip address 192.0.2.1 255.255.255.252
 no shutdown
!
interface Gi0/0/1
 description ## Connection from PE-1A (Gi0/0/1) to R2 (Gi0/1) ##
 ip address 192.0.2.5 255.255.255.252
 no shutdown
!
interface Gi0/0/2
 description ## Connection from PE-1A (Gi0/0/2) to R3 (Gi0/2) ##
 ip address 192.0.2.9 255.255.255.252
 no shutdown
!</pre>

      <p>The data pane also supports defining constant field values on the header row - you may add as many header columns using this syntax wherever you like. The rest of the data values would remain unchanged, like the header column wasn't even there. Using the above example, as "ROUTER" is always "PE-1a" then we could have written it as follows to define it as a constant:</p>

      <pre><span class="comment">ROUTER=PE-1A, INTERFACE, IP, DEST</span>
Gi0/0/0, 192.0.2.1, R1 (Gi0/0)
Gi0/0/1, 192.0.2.5, R2 (Gi0/1)
Gi0/0/2, 192.0.2.9, R3 (Gi0/2)</pre>

      <h4 class="heading">4.1. Branching and Looping Constructs</h4>

      <a name="if"></a>
      <h4 class="heading">4.1.1. IF</h4>

      <p>The IF construct is one of the most important features of many languages, templates included. It allows for the conditional use of template text based on a true or false statement. If the statement evaluates to true, the text will be displayed, and if it evaluates to false, it won't.</p>

      <pre><span class="if">&lt;IF (<span class="script">"expression"</span>)&gt;</span>
  ...
<span class="if">&lt;ELSE IF (<span class="script">"expression"</span>)&gt;</span>
  ...
<span class="if">&lt;ELSE IF (<span class="script">"expression"</span>)&gt;</span>
  ...
<span class="if">&lt;ELSE&gt;</span>
  ...
<span class="if">&lt;/IF&gt;</span>
</pre>

      <p>The "expression" will be evaluated by the JavaScript parser, so it needs to be valid JavaScript, however the syntax is relatively simple as demonstrated in the example below (white space is maintained at the beginning and end of IF blocks, but not empty lines).</p>

      <pre>interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
<span class="if">&lt;IF (<span class="script">"<span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>" == "Gi0/0/0"</span>)&gt;</span>
 no shutdown
<span class="if">&lt;ELSE IF (<span class="script">"<span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>" != "Te0/3/0/7"</span>)&gt;</span>
 shutdown
<span class="if">&lt;/IF&gt;</span>
!</pre>

      <p>In the above example, the block will display "no shutdown" if the "INTERFACE" field equals "Gi0/0/0" else "shutdown" if the "INTERFACE" field doesn't equal "Te0/3/0/7". This works fine if you want to do simple matches, but JavaScript also supports regular expressions to provide a much richer matching experience. The JavaScript <code>String.match()</code> function can be used to determine if a string contains or doesn't contain a regular expression:</p>

      <pre>interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
<span class="if">&lt;IF (<span class="script">"<span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>".match(/^Gi/i)</span>)&gt;</span>
 no shutdown
<span class="if">&lt;ELSE IF (<span class="script">!"<span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>".match(/^Te/i)</span>)&gt;</span>
 shutdown
<span class="if">&lt;/IF&gt;</span>
!</pre>

      <p>The above syntax will perform a "no shutdown" on any interface which starts with "Gi" and a "shutdown" on any other interface which doesn't start with "Te" (note the use of <code>!</code> to negate the expression as well as the use of the <code>/i</code> modifier for case-insensitive matching).</p>

      <a name="for"></a>
      <h4 class="heading">4.1.2. FOR</h4>

      <p>The FOR construct is also an important feature of many languages, templates included - it is used to support intra-row looping. There are two different syntaxes that are supported for this construct; the first allows you to specify a variable "VAR" and a comma separated list of data values, e.g. <code>"VAL1", "VAL2", ..., "VALn"</code>, the second allows you to specify a variable "VAR" and then use the <code>X TO Y [STEP N]</code> syntax for the values - if "STEP" is omitted then a default value of 1 or -1 will be used depending on the context. It will then duplicate the contents of the FOR block for every entry by substituting <code>{{VAR}}</code> for the value. If there are no entries within the list of data values then the block isn't displayed (white space is maintained at the beginning and end of FOR blocks, but not empty lines). To maintain performance and preserve memory, a maximum iteration limit of 1024 has been imposed.</p>

      <pre><span class="for">&lt;FOR VAR = ["VAL1", "VAL2", ..., "VALn"]&gt;</span>
<span class="for">{{VAR}}</span>
<span class="for">&lt;/FOR&gt;</span>
</pre>

      <p>The following example demonstrates how this could be used to include a series of "ip helper-address" statements on an interface:

      <pre>interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
 ip address <span class="field">&lt;&lt;IP&gt;&gt;</span> 255.255.255.252
<span class="for">&lt;FOR H = ["192.0.2.129", "192.0.2.130"]&gt;</span>
 ip helper-address <span class="for">{{H}}</span>
<span class="for">&lt;/FOR&gt;</span>
 no shutdown
!</pre>

      <p>Once you click on "Generate Output", the following output will be generated where you can see the "ip helper-address" has been duplicated for each entry within the list of data values:</p>
      
      <pre>interface Gi0/0/0
 ip address 192.0.2.1 255.255.255.252
 ip helper-address 192.0.2.129
 ip helper-address 192.0.2.130
 no shutdown
!
interface Gi0/0/1
 ip address 192.0.2.5 255.255.255.252
 ip helper-address 192.0.2.129
 ip helper-address 192.0.2.130
 no shutdown
!
interface Gi0/0/2
 ip address 192.0.2.9 255.255.255.252
 ip helper-address 192.0.2.129
 ip helper-address 192.0.2.130
 no shutdown
!</pre>

      <p>It should be noted that the above could have been easily done without the use of a FOR block as the values were already known. However, the real power comes when you provide the list from the data pane, where it could be different on a per line basis - this concept will be further explained within the "Scripting" section.</p>

      <p>The second type of syntax allows you to do more conventional loops that go from a start value to an end value, with an optional step (where "X" and "Y" could be a number or a character with the smaller value on the left or the right):</p>

      <pre><span class="for">&lt;FOR VAR = ["X" TO "Y" STEP N]&gt;</span>
<span class="for">{{VAR}}</span>
<span class="for">&lt;/FOR&gt;</span>
</pre>

      <p>You are permitted to nest FOR blocks as many times as you want while mixing and matching the syntax - the following primitive example demonstrates an example of this:</p>

      <pre><span class="for">&lt;FOR I = [1 TO 5 STEP 2]&gt;</span>
  <span class="for">&lt;FOR J = [B TO A]&gt;</span>
R = <span class="for">{{I}}</span>:<span class="for">{{J}}</span>
  <span class="for">&lt;/FOR&gt;</span>
<span class="for">&lt;/FOR&gt;</span>
</pre>

      <p>Once you click on "Generate Output", the following output will be generated:</p>
      
      <pre>R = 1:B
R = 1:A
R = 3:B
R = 3:A
R = 5:B
R = 5:A</pre>

      <a name="snippets"></a>
      <h4 class="heading">4.2. Snippets</h4>

      <p>To allow the re-using of templating components, TemplateFx also supports the notion of including the contents of snippets into a template. This allows a common piece of text to be written once but used multiple times in the same template - any modifications to the common snippet is seen in all occurrences within the template. Snippets are defined in the snippet panel and can then be referenced in the main template using the following syntax:</p>

      <pre>ipv4 access-list ACL-IN
 permit tcp host 192.0.2.1 gt 1023 host 192.0.2.2 eq 179
 permit tcp host 192.0.2.2 eq 179 host 192.0.2.1 gt 1023
 <span class="at">%{ACL-STANDARD}%</span>
 deny ip any any
!</pre>

      <p>The above <code>%{NAME}%</code> syntax tells TemplateFx to replace it with the contents of the snippet named "ACL-STANDARD". This directive is processed first before any substitutions have taken place which means any valid template syntax can be used within a snippet. The scope of snippets is within the DataTemplate and when the DataTemplate is saved or loaded then the snippets are included with it. There are two Snippets which have a special meaning (<code>~HEADER</code> and <code>~FOOTER</code>), which are automatically added to either the start or the end of your template - hopefully self-explanatory.</p>

      <p>Snippets also support parsing of an optional parameter by specifying parenthesis after the snippet name (i.e. <code>%{NAME("&lt;string&gt;")}%</code>) when you reference it in your template, which can then be accessed in the snippet via the <code>{%}</code> markup. Any occurrences of <code>{%}</code> in the snippet will be replaced with "&lt;string&gt;" - this could be used to pass through a literal string which allows a different response to be produced depending on what is passed through. However, care should be taken when passing through special constructs (i.e. <code>&lt;?= ?&gt;</code>) as they will be evaluated as part of the snippet body and thus need to be valid in the context they are being evaluated - to emphasise this point, special constructs won't be syntax highlighted in the main template pane.</p>

      <p>The final use of snippets is a bit of a hack, but allows DataTemplate specific options to be defined and saved within the DataTemplate. The following "special" snippets are currently supported:</p>

      <ul>
        <li><code>~HEADER</code> - The contents of this snippet are automatically added to the start of your template on output generation.</li><br />
        <li><code>~NOPROMPT</code>&nbsp;<span class="label label-danger">GUI Only</span>&nbsp;- If this snippet exists then TemplateFx won't prompt you when you click on "Generate" - it will assume the defaults and begin output generation.</li><br />
        <li><code>~GENONLOAD</code>&nbsp;<span class="label label-danger">GUI Only</span>&nbsp;- If this snippet exists then it will automatically start output generation when the DataTemplate is loaded. A specific use case is using TemplateFx via another tool, which could generate a temporary file containing a DataTemplate export that was specified on the command line when starting TemplateFx - the output would then be automatically generated and presented to the user.</li><br />
        <li><code>~FILTER</code> - This snippet is used to specify the filtering and sorting criteria that should be applied to the data before generation - see the section "Filtering and Sorting".</li><br />
        <li><code>~FOOTER</code> - The contents of this snippet are automatically added to the end of your template on output generation.</li>
      </ul>

      <h4 class="heading">4.3. Including External Files</h4> 

      <p><span class="label label-danger">GUI Only</span>&nbsp;Not supported within TemplateFx Server DataTemplates</p>

      <p>As well as snippets, TemplateFx also supports including content from external text files that are located on a locally accessible file system. This approach might be used over snippets if you have content which is shared amongst multiple templates. External files are included using the following syntax:</p>

      <pre><span class="at">%INCLUDE "\\uk\ukroot\templates\site-build-template.txt"</span>
</pre>

      <p>The above syntax instructs TemplateFx to include the contents of "\\uk\ukroot\templates\site-build-template.txt" into the template at this point. The current order of operation means that snippets are imported into the template before includes, which means snippets can include external files. A maximum filesize of 262,144 bytes is currently enforced per external file.</p>

      <a name="input"></a>
      <h4 class="heading">4.4. User Input</h4>

      <p><span class="label label-danger">GUI Only</span>&nbsp;Not supported within TemplateFx Server DataTemplates</p>

      <p>There might be some situations where you don't want to store dynamic or sensitive data within the actual DataTemplate. In these situations, TemplateFx provides the ability to request data from the user as the output is being generated through the use of input blocks using the <code>&lt;[ ... ]&gt;</code> or <code>&lt;[ ... ][0|1|2]&gt;</code> syntax. By default it will present the user with a multi-line input box, which allows you to enter data which would normally be difficult to do so using the "Data" pane. The second format of syntax allows a numerical type to be specified as per the list below:</p>

      <p><strong>0</strong><br />
      This is the default and indicates that a multi-line input box will be presented to the user - the input will be accepted when the user clicks "OK" or presses "&lt;CTRL&gt; + &lt;ENTER&gt;". 

      <p><strong>1</strong><br />
      This indicates a single-line input box will be presented to the user - the input will be accepted when the user clicks "OK" or presses "&lt;ENTER&gt;".

      <p><strong>2</strong><br />
      This indicates a single-line password input box will be presented to the user - the input will be masked and it will be accepted when the user clicks "OK" or presses "&lt;ENTER&gt;".

      <pre><span class="comment"># Use Multi-Line Input Box (Implicit Type 0)</span>
<span class="input">&lt;[ Enter Data: ]&gt;</span>

<span class="comment"># Use Multi-Line Input Box (Explicit Type 0)</span>
<span class="input">&lt;[ Enter Data: ][<span class="input_type">0</span>]&gt;</span>

<span class="comment"># Use Single-Line Input Box (Explicit Type 1)</span>
<span class="input">&lt;[ Enter Username: ][<span class="input_type">1</span>]&gt;</span>

<span class="comment"># Use Single-Line Password Input Box (Explicit Type 2)</span>
<span class="input">&lt;[ Enter Password: ][<span class="input_type">2</span>]&gt;</span>
</pre>

      <p>Regardless of how many data rows you have, the user will be prompted once per input before output generation commences (if the same input is requested multiple times then the value is cached). The value provided by the user will then replace the <code>&lt;[ ... ]&gt;</code> block.</p>

      <a name="comments"></a>
      <h4 class="heading">4.5. Comments</h4>

      <p>There are two types of comments which can be used within a template (and snippets), both of which must be used at the beginning of a line as TemplateFx doesn't presently support end of line comments. The first is a template comment and uses the <code>#</code> syntax to comment out a line in a template - this results in the line being completely ignored and not appearing in your output (if you require a <code>#</code> at the start of a line then you can escape it using <code>##</code> instead). The second type of comment, which uses the <code>!</code> syntax is used to supplement your output with comments:</p>

      <pre><span class="comment"># This comment won't appear in your output and ignores &lt;&lt;FIELDS&gt;&gt;, etc.</span>
<span class="comment">! This comment will appear in your output and doesn't ignore <span class="field">&lt;&lt;FIELDS&gt;&gt;</span>, etc.</span>
</pre>

      <p>You can also indicate that you want to highlight the entire row, which is done by using <code>#-</code> and <code>!-</code> respectively:</p>

      <pre><span style="display: inline-block; width: 100%;" class="comment">#- Using a hyphen (-) after the comment symbol will highlight the entire row.</span>
</pre>

      <a name="markers"></a>
      <h4 class="heading">4.6. Markers</h4>

      <p><span class="label label-danger">GUI Only</span>&nbsp;Not supported within TemplateFx Server DataTemplates</p>

      <p>There is a further type of comment called a "Marker", which allows you to mark a point within the Template that you can easily jump. It uses the <code>#$ &lt;TEXT&gt;</code> syntax and when placed within the Template will add an entry to the menu that appears when you right click on the Template pane. By clicking on the item within that menu, it will automatically jump to that place within the Template. The markers are case insensitive and if you add duplicate markers then it will only use the first occurrence. At the moment, TemplateFx supports a maximum of 8 markers per DataTemplate, mainly to stop the menu becoming too large.</p>

      <pre><span class="marker">#$ START</span>

<span class="comment"># ... </span>

<span class="marker">#$ END</span></pre>

      <a name="filtering"></a>
      <h4 class="heading">5. Filtering and Sorting</h4>

      <p>TemplateFx provides the capability to filter and sort the data before an output is generated. To use this feature you need to create a snippet called <code>~FILTER</code> and fill it with your filtering and sorting criteria based on the following syntax (case insensitive comparison is performed):</p>

      <pre>FIELD =~ REGEX    <span class="comment"># FIELD CONTAINS REGEX</span>
FIELD !~ REGEX    <span class="comment"># FIELD DOESN'T CONTAIN REGEX</span>
FIELD == [VALUE]  <span class="comment"># FIELD EQUALS VALUE</span>
FIELD != [VALUE]  <span class="comment"># FIELD DOESN'T EQUAL VALUE</span></pre>

      <p>Multiple criteria on different lines will be treated as "AND" and multiple criteria on the same line separated by commas will be treated as "OR". As well as filtering, it also supports the ability to sort the data using one or more fields:</p>

      <pre>SORT FIELD_1[ ASC| DESC][, FIELD_2[ ASC| DESC]][, ...]</pre>
     
      <p>By default it will sort the data in ascending order but allows you to specify "ASC" for ascending or "DESC" for descending at the end of every sort field. Multiple sort fields can be specified by adding them onto the same line separated by commas.</p>

      <pre><span class="comment">A, B, C</span>
1, 1, X
Y, 3, Z
2, 1,
1, F, Y
Z, A, W</pre>

      <p>Using the above data as an example with the following <code>~FILTER</code> snippet:</p>

      <pre>C != 
A =~ [0-9], B =~ [A-Z]
SORT A DESC, C</pre>

      <p>The above is the equivalent of ("C" doesn't equal "") AND (("A" contains a number) OR ("B" contains a letter)) and then sort by "A" in descending order and then by "C" in ascending order, which results in the following data being used when generating outputs:</p>

      <pre><span class="comment">A, B, C</span>
Z, A, W
1, 1, X
1, F, Y</pre>

      <p>It also supports the ability to filter which output groups are shown by using a special "~GROUP" field in the same way - however, you can't mix the "~GROUP" syntax with normal header fields in the same "OR" clause.</p>

      <a name="grouping"></a>
      <h4 class="heading">6. Grouping</h4>

      <p>There are two features which allow you to control how the outputs are generated: "Group By"&nbsp;<span class="label label-danger">GUI Only</span>&nbsp;and Advanced Dynamic Grouping. By default TemplateFx will generate a single output with each row's output one after another. To demonstrate the difference between these features, we are going to use the following data source as an example:</p>
      
      <pre><span class="comment">ROUTER, INTERFACE</span>
UKPE-ABC-01, Gi0/1
UKPE-ABC-01, Gi0/2
UKPE-ABC-01, Gi0/3
UKPE-ABC-02, Gi0/1
UKPE-ABC-02, Gi0/2
UKPE-ABC-03, Gi0/1</pre>

      <p>With none of the features used, we will end up with one large output, with the template output for each of the 6 rows. If we select "ROUTER" as our "Group By" field then TemplateFx will generate outputs in the same way as before, but it will combine outputs with the same value for "ROUTER" into a single output - this will result in 3 separate outputs (one per unique "ROUTER" value). As it is processing each row, it basically checks to see if we have generated an output with the same group value before, if we have then it appends it to the same output and if not then it starts a new output.</p>

      <p>The Advanced Dynamic Grouping feature allows you to expand rows into multiple outputs by defining different outputs in the same template as well as using dynamic values for group names. Let's take the following template as an example:</p>

      <pre><span class="group">&lt;GROUP = <span class="script">&lt;?= "<span class="field">&lt;&lt;ROUTER&gt;&gt;</span>-A".toLowerCase() ?&gt;</span>&gt;</span>
interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
 shutdown
!
<span class="group">&lt;/GROUP&gt;</span>

<span class="group">&lt;GROUP = <span class="field">&lt;&lt;ROUTER&gt;&gt;</span>-B&gt;</span>
interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
 shutdown
!
<span class="group">&lt;/GROUP&gt;</span></pre>

      <p>The above example will result in two outputs for each unique device (six in total) - one for the "-A" device based on the ROUTER column (but dynamically converted to lowercase first) and one for the "-B" device, also derived from the "ROUTER" column. Anything outside of those <code>GROUP</code> sections will remain in the original output - the purpose of <code>GROUP</code> sections is to move output from the original output into a new output. TemplateFx doesn't support nested <code>GROUP</code> sections as they don't make a lot of sense.</p>

      <p>It also supports the ability to change the position of where certain <code>GROUP</code> sections appear in the output by specifying an optional number to determine the order - if we take the following as an example:</p>

      <pre><span class="group">&lt;GROUP = OUTPUT&gt;</span>
FIRST
<span class="group">&lt;/GROUP&gt;</span>
      
<span class="group">&lt;GROUP = OUTPUT&gt;</span>
SECOND
<span class="group">&lt;/GROUP&gt;</span></pre>

      <p>If you have multiple rows (e.g. 3) of data then you will end up with the following output:

      <pre>FIRST
SECOND
FIRST
SECOND
FIRST
SECOND</pre>

      <p>However, if you use the following instead and specify an order (any positive number starting from 0, but it also supports <code>&lt;?= ?&gt;</code> blocks for dynamic generation of the number) for the specific <code>GROUP</code> section - then it will order the sections based on the numbers in ascending order (any <code>GROUP</code> section without a number or invalid syntax will assume "0" - which means it will be output first):</p>

      <pre><span class="group">&lt;GROUP = OUTPUT&gt;[<span class="field">0</span>]</span>
FIRST
<span class="group">&lt;/GROUP&gt;</span>
      
<span class="group">&lt;GROUP = OUTPUT&gt;[<span class="script">&lt;?= 1 ?&gt;</span>]</span>
SECOND
<span class="group">&lt;/GROUP&gt;</span></pre>

      <p>This will result in the following output:</p>

      <pre>FIRST
FIRST
FIRST
SECOND
SECOND
SECOND</pre>

      <a name="scripting"></a>
      <h4 class="heading">7. Scripting</h4>

      <p>For the more advanced users who want to do more than just simple substitution, TemplateFx has the ability to interpret dynamic templates which are written using JavaScript. This User Guide assumes you have a basic understanding of JavaScript, but if this isn't the case then the web (<a href="http://lmgtfy.com/?q=JavaScript" target="_blank">http://lmgtfy.com/?q=JavaScript</a>) has a large amount of information on it.</p>

      <p>TemplateFx supports the following different syntax within a template to support dynamic content:</p>

      <dl>
        <dt><strong><code>&lt;? ... ?&gt;</code></strong></dt>
        <dd>
          <p>This is used to define a dynamic content block where the contents of the block between the <code>&lt;? ... ?&gt;</code> will be evaluated through the JavaScript parser and any output will be substituted. For the purpose of this example we are going to modify our source data to demonstrate how we can use dynamic content to generate BGP configurations:</p>

          <pre><span class="comment">ROUTER, LOCATION, INTERFACE, PEER_IP</span>
PEXCD1A, DEV, Gi0/0/0/1, 192.0.2.2
PEXCD1B, DEV, Gi0/0/0/1, 192.0.2.6
PEXAY1A, PROD, Te0/7/0/1, 192.0.2.66
PEXAY1B, PROD, Te0/7/0/1, 192.0.2.70</pre>
       
          <p>The below example will demonstrate how to generate some BGP configuration from the source data above. It will determine the BGP AS (Autonomous System) number based on the "LOCATION" field as well as working out the suffix for the RD (Route Distinguisher) based on the "ROUTER" field (it will look to see if the router name ends in "A" or not to determine the correct suffix):</p>

          <pre><span class="comment">! </span><span class="field">&lt;&lt;ROUTER&gt;&gt;</span>
<span class="script">&lt;?</span>
<span class="script"> var BGP_AS = ("<span class="field">&lt;&lt;LOCATION&gt;&gt;</span>" == "DEV") ? "64512" : "37119";</span>
<span class="script"> var RD_SUFFIX = ("<span class="field">&lt;&lt;ROUTER&gt;&gt;</span>".match(/A$/)) ? "01" : "02";</span>
<span class="script">?&gt;</span>

router bgp <span class="script">&lt;? print(BGP_AS) ?&gt;</span>
 vrf TEST
  rd <span class="script">&lt;? print(BGP_AS) ?&gt;</span>:100<span class="script">&lt;? print(RD_SUFFIX) ?&gt;</span>
  address-family ipv4 unicast
  !
  neighbor <span class="field">&lt;&lt;PEER_IP&gt;&gt;</span>
   remote-as 65000
   address-family ipv4 unicast
    maximum-prefix 100 80 warning-only
    soft-reconfiguration inbound always
   !
  !
 !
!
          
 </pre>

          <p>Once you submit the data, it will produce the following output:</p>

          <pre><span class="comment">! PEXCD1A</span>

router bgp 64512
 vrf TEST
  rd 64512:10001
  address-family ipv4 unicast
  !
  neighbor 192.0.2.2
   remote-as 65000
   address-family ipv4 unicast
    maximum-prefix 100 80 warning-only
    soft-reconfiguration inbound always
   !
  !
 !
!


<span class="comment">! PEXCD1B</span>

router bgp 64512
 vrf TEST
  rd 64512:10002
  address-family ipv4 unicast
  !
  neighbor 192.0.2.6
   remote-as 65000
   address-family ipv4 unicast
    maximum-prefix 100 80 warning-only
    soft-reconfiguration inbound always
   !
  !
 !
!


<span class="comment">! PEXAY1A</span>

router bgp 37119
 vrf TEST
  rd 37119:10001
  address-family ipv4 unicast
  !
  neighbor 192.0.2.66
   remote-as 65000
   address-family ipv4 unicast
    maximum-prefix 100 80 warning-only
    soft-reconfiguration inbound always
   !
  !
 !
!


<span class="comment">! PEXAY1B</span>

router bgp 37119
 vrf TEST
  rd 37119:10002
  address-family ipv4 unicast
  !
  neighbor 192.0.2.70
   remote-as 65000
   address-family ipv4 unicast
    maximum-prefix 100 80 warning-only
    soft-reconfiguration inbound always
   !
  !
 !
!</pre>
          <p>Although JavaScript has no native support for HEREDOC style syntax, TemplateFx does provide limited support for it in script blocks. It uses similar syntax to other languages which do support it (e.g. PHP, Perl, etc). This is possible as TemplateFx parses the JavaScript within a script block before it is evaluated, so it is able to convert it to valid JavaScript beforehand. The following syntax is valid within a script block - the "EOF" marker can be any arbitrary text, but it must be the same at the start and the end.</p>
          <pre><span class="script">&lt;?</span>
<span class="script">var x = &lt;&lt;&lt;EOF</span>
<span class="script">This is a</span>
<span class="script">multi-line piece</span>
<span class="script">of text.</span>
<span class="script">EOF;</span>
<span class="script">?&gt;</span>
          
<span class="script">&lt;?= x ?&gt;</span></pre>
          <p>The <code>${var}</code> syntax can also be used to reference existing JavaScript variables, for example:</p>
          <pre><span class="script">&lt;?</span>
<span class="script">var sname = "Chris";</span>
<span class="script">var x = &lt;&lt;&lt;EOF</span>
<span class="script">My name is ${sname}</span>
<span class="script">EOF;</span>
<span class="script">?&gt;</span>

<span class="script">&lt;?= x ?&gt;</span></pre>
        </dd>
        <dt><strong><code>&lt;?= ... ?&gt;</code></strong></dt>
        <dd>
          <p>This is used as shorthand to <code>&lt;? print(...) ?&gt;</code>, where the <code>&lt;?=</code> is used to tell TemplateFx that we want to use the value of the variable. We could write some of the example above using the following syntax instead of the print statements:</p>

          <pre>router bgp <span class="script">&lt;?= BGP_AS ?&gt;</span>
 vrf TEST
  rd <span class="script">&lt;?= BGP_AS ?&gt;</span>:100<span class="script">&lt;?= RD_SUFFIX ?&gt;</span>
 !
!</pre>

          <p>To demonstrate some of the more powerful uses of this construct, if we revisit our FOR example above and see how we can update it to allow the user to provide the list of values within the source data. For the purpose of this example we have updated our source data to include an additional column called "HELPERS" as well as changing our "IP" field to the base "IP_SUBNET":</p>

          <pre><span class="comment">ROUTER, INTERFACE, IP_SUBNET, DEST, HELPERS</span>
PE-1A, Gi0/0/0, 192.0.2.0, R1 (Gi0/0), 192.0.2.129; 192.0.2.130; 192.0.2.131
PE-1A, Gi0/0/1, 192.0.2.4, R2 (Gi0/1)
PE-1A, Gi0/0/2, 192.0.2.8, R3 (Gi0/2), 10.254.0.1</pre>

          <p>If we now update our original template to use the <code>&lt;?= ... ?&gt;</code> syntax we can see how this becomes a much more powerful construct:</p>

          <pre>interface <span class="field">&lt;&lt;INTERFACE&gt;&gt;</span>
 ip address <span class="script">&lt;?= ip("<span class="field">&lt;&lt;IP_SUBNET&gt;&gt;</span>", +1) ?&gt;</span> 255.255.255.252
<span class="for">&lt;FOR H = [<span class="script">&lt;?= "<span class="field">&lt;&lt;HELPERS&gt;&gt;</span>".split("; ") ?&gt;</span>]&gt;</span>
 ip helper-address <span class="for">{{H}}</span>
<span class="for">&lt;/FOR&gt;</span>
 no shutdown
!</pre>

          <p>First off we are now using the built-in <code>ip()</code> function to derive the IP address of the interface - the <code>ip()</code> function is being used to add a single IP address to the base value. The JavaScript <code>split()</code> function is being used to derive the list of data from a variable provided within the data set. If we click on "Generate Output" we will get the following output:</p>

          <pre>interface Gi0/0/0
 ip address 192.0.2.1 255.255.255.252
 ip helper-address 192.0.2.129
 ip helper-address 192.0.2.130
 ip helper-address 192.0.2.131
 no shutdown
!

interface Gi0/0/1
 ip address 192.0.2.5 255.255.255.252
 no shutdown
!

interface Gi0/0/2
 ip address 192.0.2.9 255.255.255.252
 ip helper-address 10.254.0.1
 no shutdown
!</pre>
        </dd>
      </dl>

      <p><span class="label label-warning">WARNING</span>&nbsp;The JavaScript parser allows you to reference Java classes (e.g. <code>java.math.BigInteger</code>) from within JavaScript - this is called Live Connect. Although JavaScript doesn't permit access to the local file system, Java does and could allow a malicious user to send you a template that did naughty things - this is the same principal as someone sending you an Excel sheet with a malicious macro. To protect you from this, the Java SecurityManager is now enabled to stop any access to local resources by scripts.</p>

      <a name="variables"></a>
      <h4 class="heading">7.1. Built-In JavaScript Variables</h4>

      <p>As well as the standard JavaScript syntax there is also a series of built-in variables that are included with TemplateFx. These will be expanded with future versions of TemplateFx, but for the time being here is the current list:</p>

      <dl>
        <dt><strong>globals[]</strong>&nbsp;<span class="label label-danger">GUI Only</span></dt>
        <dd>
          <p><span class="label label-warning">DEPRECATED</span>&nbsp;See <code>templatefx.globals.set()</code> and <code>templatefx.globals.get()</code></p>
        </dd>
        <dt><strong>templatefx.version</strong></dt>
        <dd>
          <p>This variable returns the current TemplateFx version as a string (e.g. "2.38").</p>
        </dd>
        <dt><strong>templatefx.build</strong></dt>
        <dd>
          <p>This variable returns the current TemplateFx build number as a string (e.g. "14222").</p>
        </dd>
        <dt><strong>templatefx.jre_version</strong></dt>
        <dd>
          <p>This variable returns the current Java (JRE) version as a string (e.g. "1.8.0_162").</p>
        </dd>
        <dt><strong>templatefx.row</strong></dt>
        <dd>
          <p>This variable returns the current row within the data set.</p>
        </dd>
        <dt><strong>templatefx.rows</strong></dt>
        <dd>
          <p>This variable returns the total amount of rows within the data set.</p>
        </dd>
        <dt><strong>templatefx.output</strong></dt>
        <dd>
          <p>This variable contains the output from the template as it is being generated - as the template is processed, the contents of this variable will dynamically change. If you check this variable at the end of your template then it will contain the finished output. This is useful if you want to validate anything in the output (i.e. search through the output and find all the IP addresses to check they all have a valid host entry in DNS). Please refrain from trying to update the output using this variable as bad things could happen - please see the <code>add_output_mutation()</code> function for changing the output post generation.</p>
        </dd>
        <dt><strong>templatefx.data[row][column]</strong></dt>
        <dd>
          <p>This variable is a multi-dimensional array of the actual data with the headers in row "0". This allows you to access the raw data from whatever row you are currently processing.</p>
        </dd>
        <dt><strong>templatefx.first (["field_1[ || field_2]"], [{ "field_1": /regex/, "field_2": new RegExp("regex") }], [ignore_case])</strong></dt>
        <dd>
          <p>This variable is actually a JavaScript function and allows you to determine if this is the first time you have seen this particular field value (case insensitive comparison of value if "ignore_case" is true - default is false). It will return true if this row of data is the first time this or these field values occur (the "field" variable is always case insensitive). It also supports specifying multiple fields delimited by "||" if you wish to check if this is the first time you have seen this specific combination of values together. If you omit the "field" variable then it will return true for the first row of data. An example is included below which determines whether this is the first time we have seen this specific value within the "ROUTER" field:</p>

          <pre><span class="if">&lt;IF (<span class="script">templatefx.first("ROUTER")</span>)&gt;</span>
<span class="comment">! @ </span><span class="field">&lt;&lt;ROUTER&gt;&gt;</span>
<span class="if">&lt;/IF&gt;</span>
DATA
</pre>
          <p>The function also supports an optional secondary parameter which allows you to filter what rows you are checking against - if you don't want to specify a specific field then you can pass "null" as the first parameter. This follows the same syntax which can be found within the <code>templatefx.fields()</code> function definition.</p>
        </dd>
        <dt><strong>templatefx.last (["field_1[ || field_2]"], [{ "field_1": /regex/, "field_2": new RegExp("regex") }], [ignore_case])</strong></dt>
        <dd>
          <p>This variable is actually a JavaScript function and allows you to determine if this is the last time you will see this particular field value (case insensitive comparison of value if "ignore_case" is true - default is false) - the opposite of <code>templatefx.first()</code>. It will return true if this row of data is the last time this or these field values occur (the "field" variable is always case insensitive). It also supports specifying multiple fields delimited by "||" if you wish to check if this is the last time you have seen this specific combination of values together. If you omit the "field" variable then it will return true for the last row of data. An example is included below which determines whether this is the last time we have seen this specific combination of values for the "ROUTER" and "INTERFACE" fields:</p>

          <pre><span class="if">&lt;IF (<span class="script">templatefx.last("ROUTER||INTERFACE")</span>)&gt;</span>
<span class="comment">! ...</span>
<span class="if">&lt;/IF&gt;</span>
DATA
</pre>
          <p>The function also supports an optional secondary parameter which allows you to filter what rows you are checking against - if you don't want to specify a specific field then you can pass "null" as the first parameter. This follows the same syntax which can be found within the <code>templatefx.fields()</code> function definition.</p>
        </dd>
        <dt><strong>templatefx.field ("field")</strong></dt>
        <dd>
          <p>This function provides an alternative method of accessing the field values (the "field" variable is case insensitive) instead of using the <code>&lt;&lt;FIELD&gt;&gt;</code> syntax. This has been added for a specific use-case as there was no way to access a field value dynamically, the <code>&lt;&lt;FIELD&gt;&gt;</code> syntax doesn't support any variable or script section between the chevrons (i.e. <code>&lt;&lt;{{F}}&gt;&gt;</code>). By using this function the following is now possible:</p>

          <pre><span class="for">&lt;FOR F = ["ROUTER", "INTERFACE", "STATE"]&gt;</span>
<span class="for">{{F}}</span> has a value of <span class="script">&lt;?= templatefx.field("<span class="for">{{F}}</span>") ?&gt;</span> - equivalent of <span class="field">&lt;&lt;{{F}}&gt;&gt;</span> which isn't supported.
<span class="for">&lt;/FOR&gt;</span>
</pre>
        </dd>
        <dt><strong>templatefx.fields ("field", [{ "field_1": /regex/, "field_2": new RegExp("regex") }], [return_unique], [ignore_case])</strong></dt>
        <dd>
          <p>This function returns an array of all row values for a specific field - selected using the first parameter (all field names are always treated as case insensitive). There are a few optional arguments which allows the field values to be filtered (the function will return null if no rows match the criteria) as well as defining whether the returned array only contains unique values ("ignore_case" can be specified with "return_unique" to return a unique list of values regardless of case (default is false) - the first occurrence of a value will be used if there are different cases for the same string). At face value, this function looks quite complicated, but hopefully the following example will help explain:</p>

          <pre><span class="comment">NAME, AGE, COUNTRY</span>
CHRIS, 65, GERMANY
PAUL, 32, FRANCE
EMMA, 32, ENGLAND
SIMON, 18, GERMANY
DORRIS, 32, ESTONIA</pre>

          <p>What follows are some examples using the above data - where an argument is passed as "null", it means use the default (i.e. don't filter and don't remove duplicate values).</p>

          <pre><span class="comment"># This will return an array of the following values: [CHRIS, PAUL, EMMA, SIMON, DORRIS]</span>
<span class="comment">#  Every "NAME" row value.</span>
<span class="script">&lt;?= templatefx.fields("NAME") ?&gt;</span>
          
<span class="comment"># This will return an array of the following values: [GERMANY, FRANCE, ENGLAND, ESTONIA]</span>
<span class="comment">#  Every unique "COUNTRY" row value.</span>
<span class="script">&lt;?= templatefx.fields("COUNTRY", null, true) ?&gt;</span>         

<span class="comment"># This will return an array of the following values: [CHRIS, SIMON]</span>
<span class="comment">#  Every "NAME" who has a "COUNTRY" that matches regex /^GERMANY$/.</span>
<span class="script">&lt;?= templatefx.fields("NAME", { "COUNTRY": /^GERMANY$/ }) ?&gt;</span>         

<span class="comment"># This will return an array of the following values: [EMMA, DORRIS]</span>
<span class="comment">#  Every "NAME" who has a "COUNTRY" that matches regex /^e/i and an "AGE" that matches regex /^32$/.</span>
<span class="script">&lt;?= templatefx.fields("NAME", { "COUNTRY": /^e/i, "AGE": /^32$/ }) ?&gt;</span>

<span class="comment"># This will return an array of the following values: [CHRIS, SIMON]</span>
<span class="comment">#  Every "NAME" who has an "AGE" that doesn't contain a 2 using a negative lookahead regex.</span>
<span class="comment">#  Note: If you omit the .* from the regex then it becomes "doesn't begin with" instead of "doesn't contain".</span>
<span class="script">&lt;?= templatefx.fields("NAME", { "AGE": /^(?!.*2)/ }) ?&gt;</span></pre>
        </dd>
        <dt><strong>templatefx.globals.set ("key", "string")</strong></dt>
        <dd>
        <p>This function is used to set a global variable which is persistent across rows - however, as rows can be processed in parallel due to threading, you need to take this into consideration and use the <code>sync()</code> function if using <code>get()</code> and <code>set()</code> together. Please see the <code>sync()</code> function below for an example of an atomic operation.</p>
        </dd>
        <dt><strong>templatefx.globals.get ("key")</strong></dt>
        <dd>
        <p>This is used to obtain the value of a global variable. This is thread-safe if used in isolation, but you must be sure that the global variable has been set in a thread-safe way before calling this function.</p>
        </dd>
      </dl>

      <a name="functions"></a>
      <h4 class="heading">7.2. Built-In JavaScript Functions</h4>

      <p>In addition to the built-in variables, there is also a series of built-in functions that are included with TemplateFx. These will be expanded with future versions of TemplateFx, but for the time being here is the current list:</p>

      <dl>
        <a name="sync"></a>
        <dt><strong>sync (function() {})</strong></dt>
        <dd>
        <p>This function is similar to Java's <code>synchronized</code> keyword that ensures only one thread can ever process this block of code at the same time. This is used to create an atomic operation where all statements within the block are guaranteed to be executed without any other thread interrupting. Without this, another thread could call the <code>set()</code> operation between our thread calling <code>get()</code> and <code>set()</code> - thus our thread would overwrite the value the other thread set.</p>
        <pre><span class="script">&lt;?</span>
<span class="script">  (sync(function() {</span>
<span class="script">    if (templatefx.globals.get("mykey") == null) {</span>
<span class="script">      templatefx.globals.set("mykey", "myvalue");</span>
<span class="script">    }</span>
<span class="script">  }))();</span>
<span class="script">?&gt;</span></pre>
        <p>The above function is referred to as a JavaScript IIFE (Immediately Invoked Function Expression), where the function is executed immediately - it is a shorthand for the following alternative syntax, where we actually define a function and call it separately:</p>
        <pre><span class="script">&lt;?</span>
<span class="script">  var myfunction = sync(function() {</span>
<span class="script">    if (templatefx.globals.get("mykey") == null) {</span>
<span class="script">      templatefx.globals.set("mykey", "myvalue");</span>
<span class="script">    }</span>
<span class="script">  });</span>
<span class="script">  myfunction();</span>
<span class="script">?&gt;</span></pre>
        <p>The use of the <code>sync()</code> function is critical when using the <code>get()</code> and <code>set()</code> functions together like the above example to avoid a race condition. It isn't needed if we are just calling <code>get()</code> to obtain a previously set value.</p>
        <p><span class="label label-info">NOTE</span>&nbsp;Although it is good to get used to this, it is only required when using the TemplateFx Server at present as the GUI is still single threaded.</p>
        </dd>
        <a name="print"></a>
        <dt><strong>print ("output")</strong></dt>
        <dd>
        <p>This function is used to output text into the template and can be used in script blocks. This function won't terminate the output with a new line character.</p>
        </dd>
        <a name="println"></a>
        <dt><strong>println ("output")</strong></dt>
        <dd>
        <p>This function is used to output text into the template and can be used in script blocks. This function although similar to <code>print</code> will terminate output with a new line character.</p>
        </dd>
        <a name="counter"></a>
        <dt><strong>counter (["key"], [increment], [start])</strong></dt>
        <dd>
          <p>This function provides a thread-safe counter which will produce a series of numbers in the given sequence. If the "key" is omitted or passed as "null" then the counter is reset back to 0 (or "start") for every row. If a "key" is provided then the counter is persistent across rows, but the order isn't guaranteed due to threading where rows are processed in parallel and in a random order - the only exception is if you specify the "SORT" keyword within the "~FILTER" snippet which effectively disabled threading to maintain the sorted order. Every time you call the function with the same "key" then it will increment the counter and return the number. Different persistent counters can be created using different "key" values. There is an optional "increment" parameter which allows you to specify a different increment as opposed to the default of 1. There is also an optional "start" parameter which allows you to specify a different start number as opposed to the default of 1. The following example demonstrates both of these parameters to produce a positive and negative counter:</p>
<pre><span class="comment"># This will produce a positive sequence of 0, 5, 10, 15, 20, etc - it will persist across rows using key "id"</span>
<span class="script">&lt;?= counter("id", 5, 0) ?&gt;</span>

<span class="comment"># This will produce a negative sequence of 0, -5, -10, -15, -20, etc - it will be reset to 0 for every row</span>
<span class="script">&lt;?= counter(null, -5, 0) ?&gt;</span>

<span class="comment"># This will produce a positive sequence of 1, 2, 3, 4, 5, etc - it will be reset to 1 for every row</span>
<span class="script">&lt;?= counter() ?&gt;</span>
</pre>
        </dd>
        <a name="cancel"></a>
        <dt><strong>cancel (["message"])</strong></dt>
        <dd>
          <p>This function provides a way to cancel processing a template if something isn't right. This could be if an invalid value has been specified in the data source or if a key field hasn't been filled in correctly. An optional "message" can be provided to give the user more information about why processing was cancelled. The first time the function is executed, the whole processing is stopped.</p>
        </dd>
        <a name="skiprow"></a>
        <dt><strong>skiprow ()</strong></dt>
        <dd>
          <p>This function provides a way to skip processing of the current row and disregard all output associated with it. Once this function is called, then TemplateFx will continue processing the next row in the data as if this row never existed - please be aware that it will still exist within the data schema, so functions like <code>templatefx.first()</code> and <code>templatefx.fields()</code> will still take it into consideration.</p>
        </dd>
        <a name="expand"></a>
        <dt><strong>expand ("string")</strong></dt>
        <dd>
        <p>This function is used to expand a string that contains static character classes (i.e. "[0-9]") or static groups (i.e. "(a|b)") into an array of all the different permutations. You are permitted to use as many classes or groups within the same string - if it doesn't detect any classes or groups within the string then the "string" will be returned as the only array element. Character classes support "A-Z", "a-z" and "0-9" characters, whereas static groups allow any string of characters.</p>
<pre><span class="comment"># This will return an array containing [ "mcxxx-pe-1a", "mcxxx-pe-1b" ]</span>
<span class="script">&lt;?= expand("mcxxx-pe-1[ab]") ?&gt;</span>

<span class="comment"># This will return an array containing [ "mcxxx-pe-1a", "mcyyy-pe-1a" ]</span>
<span class="script">&lt;?= expand("mc(xxx|yyy)-pe-1a") ?&gt;</span>

<span class="comment"># This will return an array containing [ "mcxxx-pe-1a", "mcxxx-pe-1b", "mcyyy1-pe-1a", "mcyyy1-pe-1b", "mcyyy2-pe-1a", "mcyyy2-pe-1b" ]</span>
<span class="script">&lt;?= expand("mc(xxx|yyy[12])-pe-1[ab]") ?&gt;</span></pre>

<p>Within the Data Pane you may also suffix your header field within the header row with <code>**</code>, which will enable automatic field value expansion if you were to use static character classes or static groups in your values, for example:</p>

        <pre><span class="comment">ROUTER**, INTERFACE**, DESCRIPTION</span>
ABC-RTR-1[AB], Gi0/0/0/[0-9], ## Reserved for Expansion ##
XYZ-RTR-1[AB], Te0/[23]/0/[0-3], ## Reserved for Expansion ##</pre>

        <p>As you have suffixed <code>**</code> to "ROUTER" and "INTERFACE" then it will automatically expand this and generate the extra rows in your data. You will then access those values using <code>&lt;&lt;ROUTER&gt;&gt;</code> and <code>&lt;&lt;INTERFACE&gt;&gt;</code> as normal within your template.</p>

        </dd>
        <a name="base64encode"></a>
        <dt><strong>base64encode ("string")</strong></dt>
        <dd>
          <p>This function encodes a string using Base64 encoding. It will return the Base64 encoded string on success and null on failure.</p>
        </dd>
        <a name="base64decode"></a>
        <dt><strong>base64decode ("base64 encoded string")</strong></dt>
        <dd>
          <p>This function decodes a Base64 encoded string. It will return the decoded string on success and null on failure.</p>
        </dd>
        <a name="ip"></a>
        <dt>
          <strong>ip ("ip", number, [ipv6format])</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 address (doesn't support IPv4-mapped IPv6 addresses) and adds or subtracts a number of IP addresses from the value. If it is an IPv6 address then you can specify an optional third parameter which allows you to specify the presentation format of the returned IPv6 address, using one of the following values:</p>

          <p><strong>ipv6format = 0 || null</strong><br />
          This, or the default if omitted, will output the address using the <a href="http://tools.ietf.org/html/rfc4291" target="_blank">RFC4291</a> preferred format of "x:x:x:x:x:x:x:x" (i.e. 2001:db8:0:0:8:800:200c:417a), where the 'x's are one to four hexadecimal digits of the eight 16-bit pieces of the address with leading zeroes omitted.</p>

          <p><strong>ipv6format = 1</strong><br />
          This will output the address using a special compressed format (i.e. 2001:db8::8:800:200c:417a), which allows you to replace long strings of zero bits with "::". The use of "::" indicates one or more groups of 16 bits of zeroes. The "::" can only appear once in an address and should be the longest run of groups of zeroes. The "::" can also be used to compress leading or trailing zeroes in an address.</p>

          <p><strong>ipv6format = 2</strong><br />
          This will output the address using the full expanded format (i.e. 2001:0db8:0000:0000:0008:0800:200c:417a).</p>

          <p>To demonstrate this function, some examples are provided below:</p>
          
<pre><span class="comment"># Obtain the IP address before "192.0.2.10" (i.e. 192.0.2.9)</span>
<span class="script">&lt;?= ip("192.0.2.10", -1) ?&gt;</span>

<span class="comment"># Convert the IPv6 address "2001:0db8:0000:0000:0008:0800:200c:417a" into compressed form (i.e. 2001:db8::8:800:200c:417a)</span>
<span class="script">&lt;?= ip("2001:0db8:0000:0000:0008:0800:200c:417a", 0, 1) ?&gt;</span>

<span class="comment"># Add 32 to the IPv6 address "2001:db8::" and output in preferred form (i.e. 2001:db8:0:0:0:0:0:20)</span>
<span class="script">&lt;?= ip("2001:db8::", 32) ?&gt;</span></pre>
        </dd>
        <a name="insubnet"></a>
        <dt>
          <strong>insubnet ("subnet", "test ip|cidr")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes a subnet in CIDR format (i.e. "address/mask") and returns true if the passed IPv4 or IPv6 address/subnet is in the subnet or false if it isn't - when a test CIDR subnet is passed it confirms the first IP address and the last IP address are within the subnet. The following example verifies if "2001:db8::1" is contained within "2001:db8::/32":</p>
<pre><span class="if">&lt;IF (<span class="script">insubnet("2001:db8::/32", "2001:db8::1")</span>)&gt;</span>
  ...
<span class="if">&lt;/IF&gt;</span>
</pre>
        </dd>
        <a name="ipsplit"></a>
        <dt>
          <strong>ipsplit ("subnet", "cidr_mask" | min_subnets)</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
        <p>This function is used to split up a subnet into smaller subnets - the subnet parameter is provided in CIDR format (i.e. "192.0.2.0/24" or "2001:db8::/32") and the second parameter can be specified in one of two ways. The first way is by specifying a CIDR mask of the smaller subnets (e.g. "/mask") and the second is by specifying the minimum number of subnets you want (this number will be rounded up to the nearest power of 2 - e.g. 5 will become 8). The function will return "null" if an error occurs, the string "{mask overflow}" if you have used too many bits between the masks (you can't have more than 16 bits between subnet and mask), "{number overflow}" if you have used too many bits when specifying a minimum number of subnets, or an array of all the subnets on success. The following example will output all the "/29" subnets in "192.0.2.0/26" (i.e. 8 subnets) - one per row as we join the returned array using a newline character:</p>
<pre><span class="script">&lt;?= ipsplit("192.0.2.0/26", "/29").join("\n") ?&gt;</span></pre>
          <p>To demonstrate the same by specifying the minimum number of subnets, we can specify 8 as the second parameter, but using an IPv6 address this time - this will return "/35" subnets as there are 8 of them to a "/32" subnet:</p>
<pre><span class="script">&lt;?= ipsplit("2001:db8::/32", 8).join("\n") ?&gt;</span></pre>
          <p>To be able to split a subnet into smaller subnets the "cidr_mask" should be longer than the mask on the "subnet" (and have 16 bits or less between them). However, if you specify a shorter mask as your "cidr_mask" then it will return the supernet instead (i.e. using "192.0.2.0/24" with a "cidr_mask" of "/16" will return "192.0.0.0/16"). In the same sense you can specify a negative number to provide a supernet (i.e. using "192.0.2.0/28" with the minimum number of subnets as -8 will return "192.0.2.0/25").</p>
        </dd>
        <a name="cidr2range"></a>
        <dt>
          <strong>cidr2range ("cidr")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
        <p>This function is used to convert a CIDR subnet into an IP address range (e.g. "192.0.2.0/24" would produce "192.0.2.0-192.0.2.255") - it will return a string or "null" if you have tried to do something stupid. It will always return the full range including network and broadcast where applicable - if you only want the usable hosts within a CIDR subnet then please see the <code>ipfirst()</code> and <code>iplast()</code> functions. Although I mention a CIDR address, it does support any format of subnet as input (e.g. "192.0.2.0 255.255.255.0" or "192.0.2.0 0.0.0.255" are also valid).</p>
        </dd>
        <a name="range2cidr"></a>
        <dt>
          <strong>range2cidr ("range")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
        <p>This function is used to convert an IP address range into the smallest number of CIDR subnets to cover the entire range. The "range" parameter specifies a start and end address (e.g. "192.0.2.1-192.0.2.137" or "2001:db8::-2001:db8::ABC") and will return an array of subnets or "null" if you have tried to do something stupid. The following example will output all the subnets between "192.0.2.87" and "192.0.2.177" - one per row as we join the returned array using a newline character:</p>
<pre><span class="script">&lt;?= range2cidr("192.0.2.87-192.0.2.177").join("\n") ?&gt;</span></pre>
        <p>This results in the following output:</p>
<pre>192.0.2.87/32
192.0.2.88/29
192.0.2.96/27
192.0.2.128/27
192.0.2.160/28
192.0.2.176/31
</pre>
        </dd>
        <a name="aggregate"></a>
        <dt>
          <strong>aggregate (new Array("cidr", "cidr", ...), [gaps])</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function is used to find the shortest list of aggregate subnets that cover the list of IPv4/IPv6 subnets provided. It aggregates adjacent subnets ensuring the summary is explicit in only containing the provided subnets. By default it doesn't highlight where we have no contiguous blocks, but by setting the optional parameter "gaps" you can control it as follows:</p>

          <p><strong>gaps = 0 || null</strong><br />
          This, or the default if omitted, will output a simple list of summarised prefixes without implying whether they are contiguous or discontiguous.</p>

          <p><strong>gaps = 1</strong><br />
          This will output a list of summarised prefixes, but will include a "-" where there is a gap between the prefixes (i.e. if the list is discontiguous).</p>

          <p><strong>gaps = 2</strong><br />
          This will output a list of summarised prefixes, but will fill in the missing prefixes to make the list contiguous from start to finish - any prefixes which fill the gaps will be prefixed with "-".</p>

          <p>The following example demonstrates this function by outputting the aggregates one per row:</p>

<pre><span class="script">&lt;?</span>
<span class="script">  var subnets = [</span>
<span class="script">    "192.0.2.0/31",</span>
<span class="script">    "192.0.2.4 255.255.255.252",</span>
<span class="script">    "192.0.2.8/30",</span>
<span class="script">    "192.0.2.12/30",</span>
<span class="script">    "192.0.2.16 255.255.255.248",</span>
<span class="script">    "192.0.2.24/29",</span>
<span class="script">    "2001:db8::8:800:200c:417a/64"</span>
<span class="script">  ];</span>
<span class="script">?&gt;</span>

<span class="script">&lt;?= aggregate(subnets, 1).join("\n") ?&gt;</span></pre>
        <p>This results in the following output:</p>
<pre>192.0.2.0/31
-
192.0.2.4/30
192.0.2.8/29
192.0.2.16/28

2001:db8:0:0:0:0:0:0/64
</pre>

          <p>If you were to set "gaps" to 2 then you would get the following with the gap filled in:</p>

<pre>192.0.2.0/31
- 192.0.2.2/31
192.0.2.4/30
192.0.2.8/29
192.0.2.16/28

2001:db8:0:0:0:0:0:0/64
</pre>

        </dd>
        <a name="supernet"></a>
        <dt>
          <strong>supernet ("cidr_1", "cidr_2")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes a pair of CIDR prefixes and finds the smallest subnet that encompasses them both. In most cases this will produce a subnet that is much larger then just the two subnets and in this instance the subnet returned will be prefixed with "~" to indicate this. In scenarios where an exact subnet is found (e.g. <code>supernet("192.0.2.0/29", "192.0.2.8/29")</code>) then it will return the subnet without a prefix.</p>
        </dd>
        <a name="network"></a>
        <dt>
          <strong>network ("cidr", [return_mask])</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 prefix in CIDR format (i.e. "192.0.2.13/24" or "2001:db8::8:800:200c:417a/64") and returns the network address. The function will return "null" if an error occurs, an invalid parameter is detected. In the above example it will return the string "192.0.2.0" for IPv4 and "2001:db8:0:0:0:0:0:0" for IPv6. By default it doesn't return the CIDR mask, but there is an optional parameter "return_mask", which if set to "true" will return it using CIDR notation.</p>
        </dd>
        <a name="ipfirst"></a>
        <dt>
          <strong>ipfirst ("cidr")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 prefix in CIDR format (i.e. "192.0.2.13/24" or "2001:db8::8:800:200c:417a/64") and returns the first usable address of the subnet. The function will return "null" if an error occurs or an invalid parameter is detected.</p>
        </dd>
        <a name="iphosts"></a>
        <dt>
          <strong>iphosts ("cidr", [nwbc])</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 prefix in CIDR format (i.e. "192.0.2.13/24" or "2001:db8::8:800:200c:417a/64") and returns (as an array) all the usable addresses of the subnet. The function will return "null" if an error occurs or an invalid parameter is detected. By default it doesn't return the "network" and "broadcast" address of IPv4 subnets, but there is an optional parameter "nwbc", which if set to "true" will return them.</p>
        </dd>
        <a name="iplast"></a>
        <dt>
          <strong>iplast ("cidr")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 prefix in CIDR format (i.e. "192.0.2.13/24" or "2001:db8::8:800:200c:417a/64") and returns the last usable address of the subnet. The function will return "null" if an error occurs or an invalid parameter is detected.</p>
        </dd>
        <a name="broadcast"></a>
        <dt>
          <strong>broadcast ("cidr")</strong>
          <span class="label label-danger">IPv4 Only</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 prefix (there is no concept of a broadcast in IPv6) in CIDR format (i.e. "192.0.2.13/24") and returns the broadcast address. The function will return "null" if an error occurs, an invalid parameter is detected or if the mask length doesn't support a broadcast address (i.e. /31 or /32).</p>
        </dd>
        <a name="smask"></a>
        <dt>
          <strong>smask ("cidr", [inverse])</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 prefix in CIDR format (i.e. "192.0.2.13/24" or "2001:db8::8:800:200c:417a/64") and returns the subnet mask (e.g. "255.255.255.0" or "ffff:ffff:ffff:ffff::") or for IPv4 addresses only, the inverse/wildcard mask (e.g. "0.0.0.255") if the optional parameter "inverse" is true. The function will return "null" if an error occurs or if an invalid parameter is detected.</p>
        </dd>
        <a name="cidrmask"></a>
        <dt>
          <strong>cidrmask ("mask")</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 or IPv6 subnet mask (i.e. "255.255.255.0" or "0.0.0.255" or "ffff:ffff:ffff:ffff::") and returns the cidr prefix length (e.g. "24" or "64"). The function will return "null" if an error occurs or if an invalid parameter is detected.</p>
        </dd>
        <a name="ip2long"></a>
        <dt>
          <strong>ip2long ("ip")</strong>
          <span class="label label-danger">IPv4 Only</span>
        </dt>
        <dd>
          <p>This function takes an IPv4 address and converts it into a long.</p>
        </dd>
        <a name="long2ip"></a>
        <dt>
          <strong>long2ip (long)</strong>
          <span class="label label-danger">IPv4 Only</span>
        </dt>
        <dd>
          <p>This function takes a long and converts it into an IPv4 address.</p>
        </dd>
        <a name="nslookup"></a>
        <dt>
          <strong>nslookup ("query", [response_type])</strong>
          <span class="label label-danger">IPv4</span> + <span class="label label-primary">IPv6</span>
        </dt>
        <dd>
          <p>This function performs a forward or reverse DNS lookup - for reverse DNS lookups it takes an IPv4 or IPv6 address (doesn't support IPv4-mapped IPv6 addresses), converts it to a PTR record, then attempts to resolve it and returns the hostname as a string (entries are separated using a semi-colon if multiple entries exist) on success or "null" on failure - the "response_type" field is ignored on these type of requests. For forward DNS lookups it takes a hostname and attempts to resolve it (it will follow CNAME records if they exist until it finds an IP address) - this may result in multiple IP addresses so is returned as an array of addresses on success or "null" on failure (the locally configured DNS search list isn't checked, so you will need to specify the domain part as well). By default it will use the system DNS servers, but it will respect the "Custom Name Servers" field in the "IP Calc" pane, but will ignore the "DNS Search List". The optional second parameter allows you to control what records are returned on forward DNS lookups and can be one of the following values:</p>

          <p><strong>response_type = 0 || null</strong><br />
          This, or the default if omitted, will return both AAAA and A records (AAAA before A) when performing a forward DNS lookup.</p>

          <p><strong>response_type = 1</strong><br />
          This will return only A records and omit any AAAA records returned - this may result in a "null" response if no A records exist.</p>

          <p><strong>response_type = 2</strong><br />
          This will return only AAAA records and omit any A records returned - this may result in a "null" response if no AAAA records exist.</p>

          <p>In addition to being able to lookup a single address, it also supports being passed a list of IP addresses to resolve, with an array being returned with the results - on failure a single "null" will be returned. This could be used in the following way to lookup all usable hosts within a subnet by combining it with the <code>iphosts()</code> function (with a result per line):</p>

          <pre><span class="script">&lt;?= nslookup(iphosts("192.0.2.0/28")).join("\n") ?&gt;</span></pre>

          <p>An alternative way of doing the same thing, but with more control on the output would be using a FOR loop as follows:</p>

<pre><span class="for">&lt;FOR H = [<span class="script">&lt;?= iphosts("192.0.2.0/28") ?&gt;</span>]&gt;</span>
<span class="for">{{H}}</span> = <span class="script">&lt;?= nslookup("<span class="for">{{H}}</span>") ?&gt;</span>
<span class="for">&lt;/FOR&gt;</span>
</pre>
        </dd>
        <a name="curl"></a>
        <dt><strong>curl ("url", ["basic_auth_string"], [ignore_ssl_cert], [timeout])</strong></dt>
        <dd>
          <p>This function can be used to download http/https based content using the HTTP GET method. The only mandatory argument is "url" which is the same as what you would enter into your web browser (e.g. "https://www.google.com"). It supports HTTP Basic Authentication and if required can be invoked by providing a Base64 encoded string in the format of "username:password" as the "basic_auth_string" argument. HTTP Cookies are also supported and will persist for subsequent requests to the same server. If a HTTPS URL has been provided then it will check to ensure a valid trusted SSL certificate is being presented - you can override this behaviour by passing a value of "true" to the "ignore_ssl_cert" argument which will permit self-signed certificates to be accepted and bypass other security checks (this isn't advisable or recommended, but is provided out of necessity). The "timeout" argument can be used to specify a connection timeout in milliseconds - the default timeout is 5000 ms (5 seconds). At the moment this function only supports direct connections - the use of a proxy server isn't supported.</p>

          <p>On success this function will return the contents of the HTTP response as a string and on failure it will return one of following numerical error codes:</p>
          
          <p><strong>0</strong><br />
          An error occurred when trying to connect - the error message will be printed to the "Console" tab.</p>

          <p><strong>1</strong><br />
          A timeout occurred when trying to connect - this might be temporary and if you try again it might succeed, if not then try increasing the "timeout" value. </p>

          <p><strong>100 to 599</strong><br />
          The web server responded with a HTTP response code that wasn't 200.</p>

          <pre><span class="script">&lt;?</span>
<span class="script">  var r = curl("http://templatefx.org");</span>
<span class="script">  if (isNaN(r)) {</span>
<span class="script">    // r = HTTP CONTENT</span>
<span class="script">  }</span>
<span class="script">  else if (r === 0) {</span>
<span class="script">    // ERROR - SEE CONSOLE</span>
<span class="script">  }</span>
<span class="script">  else if (r === 1) {</span>
<span class="script">    // TIMEOUT</span>
<span class="script">  }</span>
<span class="script">  else {</span>
<span class="script">    // r = HTTP RESPONSE CODE</span>
<span class="script">  }</span>
<span class="script">?&gt;</span></pre>

          <p>The above example demonstrates how you can check for success or failure when using this function. We use the <code>isNaN()</code> function to determine if we have a numerical or textual response - it assumes any numerical only response is some sort of error.</p>
        </dd>
        <a name="passwd"></a>
        <dt><strong>passwd ([length], [ ["chars", ...] ])</strong></dt>
        <dd>
        <p>This function generates a cryptographically secure and strong random password using the following characters: "A-Z", "a-z", "0-9" and "!$@%?" - unless a custom character set has been provided. The length is determined by the passed "length" parameter or a length of 22 is used if the parameter is omitted. The "chars" parameter can either be a string of characters or can be an array of character sets (e.g. "['ABC...', 'abc...', '012...']") - if this is the case then the function will ensure the password contains at least one character from each character set.</p>
<pre><span class="comment"># Generate a random 12 character password from the provided characters</span>
<span class="script">&lt;?= passwd(12, "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZZ") ?&gt;</span>

<span class="comment"># Generate a random 16 character password ensuring it contains at least one character from each set</span>
<span class="script">&lt;?= passwd(16, ["ABCDEFG", "abcdefg", "0123456789", "!@"]) ?&gt;</span></pre>
        </dd>
        <a name="cisco7decode"></a>
        <dt><strong>cisco7decode ("password")</strong></dt>
        <dd>
          <p>As the name suggests, this function will reverse those Cisco passwords which have been encoded by Cisco's type 7 encoding scheme - these are commonly found in Cisco device configurations.</p>
        </dd>
        <a name="pad"></a>
        <dt><strong>pad ("string", length, [align], [pchar])</strong></dt>
        <dd>
          <p>This function provides left, right or centre alignment of text using padding. If the length of the "string" is less than the provided length, then the "string" will be padded. By default, the "string" is padded with space (or a different character via "pchar") on the right (left alignment), which can be changed using the optional third parameter with one of the following values:</p>

          <p><strong>align = 0 || null</strong><br />
          This, or the default if omitted, will output the "string" with padding at the end of the text (left alignment).</p>

          <p><strong>align = 1</strong><br />
          This will output the "string" with padding at the beginning of the text (right alignment).</p>

          <p><strong>align = 2</strong><br />
          This will output the "string" with half the padding at the beginning and half at the end (centre alignment).</p>
        </dd>
        <a name="timestamp"></a>
        <dt><strong>timestamp (["format"])</strong></dt>
        <dd>
          <p>This function generates a timestamp based on the current date and time, either based on a provided format (using the same format as Java's <a href="http://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html" target="_blank">SimpleDateFormat</a> class) or using a default pattern if omitted.</p>
        </dd>
        <a name="date"></a>
        <dt><strong>date ("date", "format", amount, ["dest_format"], ["field"])</strong></dt>
        <dd>
          <p>This function is used to manipulate dates by adding or subtracting a duration from a given date, or by converting one date format to another. The "date" field is used to pass a particular date string and the "format" field is used to specify the format of that given date (using the same format as Java's <a href="http://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html" target="_blank">SimpleDateFormat</a> class). The "amount" field specifies the number of days (by default) to add or subtract from the given date - to subtract days, a negative number can be provided. On success it will return the manipulated date in the same format that was provided - you can specify a different output format using the "dest_format" optional parameter (using the same formatting rules). By default this function operates using days, but by specifying either "d" for days, "w" for weeks, "m" for months or "y" for years as the "field" parameter, the default behaviour can be changed.</p>
<pre><span class="comment"># Add 5 days to 27/04/2016 and output using dd/MMMM/yyyy (i.e. 02 May 2016)</span>
<span class="script">&lt;?= date("27/04/2016", "dd/MM/yyyy", 5, "dd MMMM yyyy") ?&gt;</span>

<span class="comment"># Subtract 7 days from 03/JAN/2016 and output using the same format (i.e. 25/Dec/2015)</span>
<span class="script">&lt;?= date("01/Jan/2016", "dd/MMM/yyyy", -7) ?&gt;</span>

<span class="comment"># Convert date 29/02/16 from dd/MM/yy to dd/MMM/yyyy (i.e. 29/Feb/2016)</span>
<span class="script">&lt;?= date("29/02/16", "dd/MM/yy", 0, "dd/MMM/yyyy") ?&gt;</span>

<span class="comment"># Add 5 weeks to 18/OCT/2014 and output using the same format (i.e. 22/Nov/2014)</span>
<span class="script">&lt;?= date("18/Oct/2014", "dd/MMM/yyyy", 5, null, "w") ?&gt;</span></pre>
        </dd>
        <a name="add_output_mutation"></a>
        <dt><strong>add_output_mutation ("regex", "replacement")</strong></dt>
        <dd>
          <p>This function allows you to make changes to the output post generation before it is displayed. This function can be called at any point in your template, but it won't perform the changes until after the output has finished being generated. The replacements will be performed in the order they are added. This function could be used to insert information into your template that isn't known at the point where you want it inserted. As an example, you might want to add a section to your output which lists all the IP addresses which have been used in your output, however you won't being able to produce this list until after the output has been generated. You could leave a placeholder (i.e. "[PLACEHOLDER]") in the template and then use this function to update it at the end with the list of IP addresses that have been found by searching through the output using <code>templatefx.output</code>. The "regex" is case-sensitive and must be provided as a string as opposed to the <code>/regex/</code> JavaScript construct.</p>
        </dd>
        <a name="console.log"></a>
        <dt><strong>console.log ("message")</strong></dt>
        <dd>
          <p>This function is used for console logging to aid troubleshooting. It will write the passed message to the console. This allows you to debug your templates to output the current value of a variable, etc in different places.</p>
        </dd>
        <a name="banner"></a>
        <dt><strong>banner ("text", ["pre_char"], ["fill_char"], ["charset"], ["post_char"])</strong></dt>
        <dd>
          <p>This function generates an ASCII banner with the provided "text" - this mimics the Unix "banner" utility which is found in some distributions. It currently supports two character sets: "regular" and "small" with "regular" being the default which provides 7x7 upper case characters and 6x6 lower case characters. The "small" character set provides a subset (<code>A-Z</code>, <code>0-9</code> and <code>-+.</code>) of characters in a slightly smaller 5x5 form factor.</p>

          <p>The "pre_char" argument is optional and allows you to specify a start of line character. In the same sense the "post_char" argument is also optional and allows you to specify an end of line character - both options can be specified as an empty string or null to use the default (nothing). The "fill_char" argument is also optional and will default to "#", but any character can be specified (even Unicode as per the example below). The "charset" argument allows you to switch between the two character sets. The following example demonstrates a banner using the text "TemplateFx" using the "FULL BLOCK (2588 in Hex)" UTF-8 character:</p>

          <pre><span class="script">&lt;?= banner("TemplateFx", null, "\u2588", "small") ?&gt;</span></pre>

          <p>The above syntax will be translated into the following banner in your output:</p>

          <pre>&#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;   &#9608;  &#9608;&#9608;&#9608;&#9608;   &#9608;       &#9608;&#9608;&#9608;   &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;   &#9608;
  &#9608;    &#9608;      &#9608;&#9608; &#9608;&#9608;  &#9608;   &#9608;  &#9608;      &#9608;   &#9608;    &#9608;    &#9608;      &#9608;       &#9608; &#9608;
  &#9608;    &#9608;&#9608;&#9608;    &#9608; &#9608; &#9608;  &#9608;&#9608;&#9608;&#9608;   &#9608;      &#9608;&#9608;&#9608;&#9608;&#9608;    &#9608;    &#9608;&#9608;&#9608;    &#9608;&#9608;&#9608;      &#9608;
  &#9608;    &#9608;      &#9608;   &#9608;  &#9608;      &#9608;      &#9608;   &#9608;    &#9608;    &#9608;      &#9608;       &#9608; &#9608;
  &#9608;    &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;   &#9608;  &#9608;      &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;   &#9608;    &#9608;    &#9608;&#9608;&#9608;&#9608;&#9608;  &#9608;      &#9608;   &#9608;</pre>
        </dd>
        <a name="rot13"></a>
        <dt><strong>rot13 ("string")</strong></dt>
        <dd>
          <p>This function encodes (or decodes) a "string" using "rot13". Not to be confused with any sort of encryption as it is a very basic substitution cipher which can be easily reversed. It could be used to encode strings to stop the casual passer-by from gleaning passwords from looking at your screen, if you feel it necessary to hard code them into your templates.</span>
        </dd>
      </dl>

      <h4 class="heading">7.3. External JavaScript Libraries</h4>

      <p>In addition to the built-in JavaScript variables and functions, TemplateFx also supports globally including external JavaScript libraries. You can select the "JavaScript Libraries" menu item on the "File" menu to add or remove libraries (or using "-lib" when using the TemplateFx Server) - these are persistent across application restarts, enabled globally and will be available for every DataTemplate. By default TemplateFx will cache the loading of JavaScript Libraries on the first run (you can disable this by deselecting the "Cache JavaScript Libraries" option) - this is because Java seems to be getting slower and slower at parsing JavaScript with every release and this speeds things up a bit.</p>

      <a name="server"></a>
      <h4 class="heading">8. TemplateFx as a Service (REST API)</h4>

      <p>As it isn't always possible to deploy the Java Runtime Environment within a Desktop environment, maybe due to corporate policy or user preference, TemplateFx can also be deployed as a service instance using the TemplateFx Server component. In this scenario it provides a HTTP based REST API to allow templating to occur from a number of different clients without having the burden of installing the TemplateFx GUI. Any client (i.e. Web Browser, Perl, PHP, Curl, Microsoft Excel, etc) which is able to establish a HTTP connection can use the REST API to generate outputs based on templates - it could be a service activation service that uses it to generate configuration on the fly from an order form, etc.</p>

      <p>The TemplateFx Server is a cut down version of TemplateFx which is contained within a separate JAR file and only contains the core templating engine. It is run via the command line and supports the following command line options:</p>

      <dl>
        <dt><strong>HTTP Server Mode</strong></dt>
        <dd>
          <p><code>java -jar TFxServer.jar -s [host[:port]] [-lib &lt;library.js&gt;] [-log &lt;logfile&gt;] [-t &lt;timeout&gt;] [-dumpreq]</code></p>
          <p>The "-s" parameter is used to initiate the TemplateFx Server and by default without any other parameters it will listen on TCP port 8080 on 127.0.0.1 only (localhost - doesn't accept remote connections) - if you prefer, you can specify a different host or port as a parameter (i.e. "0.0.0.0:8080" to listen on all IPs - use with caution). The "-lib" parameter is used to specify external JavaScript modules (it can be used multiple times) - they are loaded server side so are accessible to all API clients. The "-t" parameter is used to change the default processing timeout in seconds from 120 seconds - you can specify 0 to disable the timeout altogether. The "-dumpreq" parameter is used to output more verbose information on what it has been asked to process.</p>
          <p>As the TemplateFx Server only supports HTTP, it should only be bound to "localhost", but you can use Apache's "ProxyPass" directive (or similar under NGINX) to forward requests to the TemplateFx Server - the following syntax will send requests sent to "/api/generate" via "http://127.0.0.1:8080/generate"). This allows Apache to manage the certificates and TLS configuration to ensure the traffic is secured over the network.</p>
          <pre>ProxyRequests Off
ProxyPass /api http://127.0.0.1:8080</pre>
        </dd>
        <dt><strong>Offline Mode</strong></dt>
        <dd>
          <p><code>java -jar TFxServer.jar -dt &lt;dataTemplate&gt; -out &lt;outfile&gt; [-lib &lt;library.js&gt;] [-log &lt;logfile&gt;] [-t &lt;timeout&gt;]</code></p>
          <p>An alternative option is to use the TemplateFx Server component in Offline Mode by running it from the command line as and when you wish to generate an output. With this method, you provide it with an input DataTemplate and it will generate the output to the specified file. This could be called directly from a local script or from another program to generate outputs whenever you require, without having to support a TCP connection. The format of the DataTemplate is identical to the POST DATA associated with the REST API which is detailed below.</p>
        </dd>
      </dl>

      <p>In addition to the above command line arguments, the TemplateFx Server also supports the following environment variables - in a scenario where both environment variables and command line arguments are present then command line arguments will replace the environment variables:</p>

      <dt><strong>TFX_LIB</strong></dt>
        <dd>
          <p>This is used to specify external JavaScript libraries and is the same as the "-lib" command line argument. Multiple libraries can be specific by separating them with a semi-colon (i.e. LIB1;LIB2;LIBn).</p>
        </dd>

      <dt><strong>TFX_LOGFILE</strong></dt>
        <dd>
        <p>This is used to specify a logfile to use for logging and is the same as the "-log" command line argument.</p>
        </dd>

      <h4 class="heading">8.1. Request Format</h4>

      <p>To submit a request to the TemplateFx Server you need to use a standard HTTP POST request using the URL "/generate". The POST DATA should contain your DataTemplate in the text based format that is described in section 3 of this document or preferably using the web friendly JavaScript Object Notation (JSON) format - an example of both has been included below. The "Content-Type" header must be either "application/json" or "application/datatemplate" depending on the request format.</p>

      <h4 class="heading">8.1.1. JavaScript Object Notation (JSON) Format</h4>

      <pre>POST /generate HTTP/1.1
Host: 127.0.0.1:8080
Content-Type: application/json; charset=utf-8
Content-Length: 207

<span style="color: darkgreen;">{
  "data": "&lt;base64 string&gt;",
  "template": "&lt;base64 string&gt;",
  "group_by": "FIELD_1[ || FIELD_2][ || ...]",
  "snippets": {
    "NAME_1": "&lt;base64 string&gt;",
    "NAME_2": "&lt;base64 string&gt;"
  }
}</span></pre>

      <h4 class="heading">8.1.2. DataTemplate Format</h4>

      <p><span class="label label-warning">DEPRECATED</span>&nbsp;It is preferred and recommended to pass requests using the "application/json" content type.</p>

      <pre>POST /generate HTTP/1.1
Host: 127.0.0.1:8080
Content-Type: application/datatemplate; charset=utf-8
Content-Length: 483 

<span style="color: darkgreen;"><strong>&lt;templatefx:data&gt;</strong>
ROUTER, INTERFACE, IP_SUBNET, DEST, HELPERS
PE-1A, Gi0/0/0, 192.0.2.0, R1 (Gi0/0), 192.0.2.129; 192.0.2.130; 192.0.2.131
PE-1A, Gi0/0/1, 192.0.2.4, R2 (Gi0/1)
PE-1A, Gi0/0/2, 192.0.2.8, R3 (Gi0/2), 10.254.0.1
<strong>&lt;/templatefx:data&gt;</strong>

<strong>&lt;templatefx:template&gt;</strong>
interface &lt;&lt;INTERFACE&gt;&gt;
 ip address &lt;?= ip("&lt;&lt;IP_SUBNET&gt;&gt;", +1) ?&gt; 255.255.255.252
&lt;FOR H = [&lt;?= "&lt;&lt;HELPERS&gt;&gt;".split("; ") ?&gt;]&gt;
 ip helper-address {{H}}
&lt;/FOR&gt;
 no shutdown
!
<strong>&lt;/templatefx:template&gt;</strong></span></pre>

      <h4 class="heading">8.2. Response Format</h4>

      <p>Assuming the request is valid HTTP and you don't get a HTTP error code back (i.e. something which isn't HTTP 200 OK), then there are two different response formats (all responses use JSON as per most REST APIs) - one for success and one for failure.</p>

      <p>All responses will have a "version" field which is expected to be set to "1.0" as this defines the version of the API - any changes which radically change the response format will increase the version number. The "status" field is either "ok" or "error" depending on the response - when it is "ok" then it will return the generated outputs using array notation via the "outputs" object, which contains a separate hash containing a "group" and "value" key per output. In all instances the outputs themselves are encoded using Base64. The "console" field is also always included on success, but may be empty if nothing was written to it - again always Base64 encoded. The "elapsed" field is the processing duration in seconds represented to 3 decimal places and the "uptime" field will report the uptime of the TemplateFx Server in seconds. When the status is "error" then it will return an error "code" and "message" to tell you what went wrong.</p>

      <h4 class="heading">8.2.1. On Success</h4>

<pre>
{
  "version": "1.0",
  "status": "ok",
  "elapsed": &lt;float&gt;,
  "uptime": &lt;integer&gt;,
  "console": "&lt;base64 string&gt;",
  "outputs": [
    {
      "group": "&lt;string&gt;",
      "value": "&lt;base64 string&gt;"
    },
    {
      "group": "&lt;string&gt;",
      "value": "&lt;base64 string&gt;"
    }
  ]
}
</pre>


      <h4 class="heading">8.2.2. On Error</h4>

<pre>
{
  "version": "1.0",
  "status": "error",
  "uptime": &lt;integer&gt;,
  "error": {
    "code": &lt;integer&gt;,
    "message": "&lt;string&gt;"
  }
}
</pre>

      <h4 class="heading">8.3. Docker and TemplateFx Server</h4>

      <p>There is also a <a target="_blank" href="https://github.com/chrixm/templatefx/raw/master/Dockerfile">Dockerfile</a> available for the TemplateFx Server which contains everything you need to start a local TemplateFx Server running within a Docker container. To demonstrate how quickly you can get a TemplateFx Server up and running, the following commands can be executed on a new Linux install (this example was done using Ubuntu on AWS EC2, but others can equally be used).</p>

      <pre><span class="comment"># Install Docker</span>
wget -qO- https://get.docker.com | sh

<span class="comment"># Build Image</span>
docker image build -t templatefx:latest https://github.com/chrixm/templatefx/raw/master/Dockerfile

<span class="comment"># Run Container (Listens on 127.0.0.1:8080)</span>
docker container run -d --name templatefx --restart unless-stopped -e TZ=Europe/London -p 127.0.0.1:8080:8080 templatefx:latest

<span class="comment"># Install Apache2 and Let's Encrypt</span>
apt install apache2 python-certbot-apache
a2enmod ssl proxy_http

<span class="comment"># Generate a Let's Encrypt Certificate</span>
certbot --apache -d <span class="field">&lt;&lt;PUBLIC FQDN&gt;&gt;</span>

<span class="comment"># Add ProxyPass to Apache2 to Proxy Requests to TemplateFx Server</span>
sed -i <font style="color: darkred;">'/&lt;VirtualHost/a \
  ProxyRequests Off \
  &lt;Location /api/&gt; \
    ProxyPass http://127.0.0.1:8080/ \
  &lt;/Location&gt;'</font> /etc/apache2/sites-available/000-default-le-ssl.conf

<span class="comment"># Restart Apache2</span>
systemctl restart apache2</pre>

      <p>The above example will proxy anything to "/api" to the TemplateFx Server. It is done this way as Apache is much better at handling TLS from both a security and ease of certificate management perspective than the TemplateFx Server - don't re-invent the wheel if something already exists!</p>

      <h4 class="heading">8.4. JavaScript Client Example</h4>

      <p>As an example, I have included a simple HTML page with some JavaScript that makes a call to the TemplateFx Server - it assumes it is running on the same host and we have setup the "/api" location as per the above example. We basically define some data, define a template and then pass it via an <code>XMLHttpRequest</code> object to the TemplateFx Server. The response is then decoded and printed into the web page. As JavaScript doesn't support HEREDOC syntax we are using some JavaScript magic to simulate multi-line strings where we don't have to escape chevrons in the template.</p>

<pre><span style="color: #0000ff">&lt;!DOCTYPE html&gt;</span>
&lt;html lang=<span style="color: #a31515">&quot;en&quot;</span>&gt;
  &lt;head&gt;
    &lt;meta charset=<span style="color: #a31515">&quot;utf-8&quot;</span>&gt;
    &lt;meta http-equiv=<span style="color: #a31515">&quot;X-UA-Compatible&quot;</span> content=<span style="color: #a31515">&quot;IE=Edge&quot;</span>&gt;
    &lt;script&gt;
      <span style="color: #0000ff">var</span> templatefx_url = <span style="color: #a31515">&#39;/api/generate&#39;</span>;
      <span style="color: #0000ff">var</span> datatemplate = {};

      <span style="color: #0000ff">function</span> multiline(f) {
        <span style="color: #0000ff">return</span> f.toString().replace(<span style="color: #a31515">/(?:^.+[\r\n]+|.+$)/g</span>, <span style="color: #a31515">&#39;&#39;</span>);
      }

      datatemplate.data = window.btoa(multiline(<span style="color: #0000ff">function</span>() { <span style="color: #008000">/*</span>
<span style="color: #008000">A, B, C</span>
<span style="color: #008000">1, 2, 3</span>
<span style="color: #008000">4, 5, 6</span>
<span style="color: #008000">      */</span> }));

      datatemplate.template = window.btoa(multiline(<span style="color: #0000ff">function</span>() { <span style="color: #008000">/*</span>
<span style="color: #008000">A is &lt;&lt;A&gt;&gt;</span>
<span style="color: #008000">B is &lt;&lt;B&gt;&gt;</span>
<span style="color: #008000">C is &lt;&lt;C&gt;&gt;</span>
<span style="color: #008000">      */</span> }));

      datatemplate.snippets = {
        <span style="color: #a31515">&#39;~FILTER&#39;</span>: window.btoa(multiline(<span style="color: #0000ff">function</span>() { <span style="color: #008000">/*</span>
<span style="color: #008000">A == 1</span>
<span style="color: #008000">        */</span> }))
      };

      <span style="color: #0000ff">var</span> xHR = <span style="color: #0000ff">new</span> XMLHttpRequest();
      xHR.open(<span style="color: #a31515">&#39;POST&#39;</span>, templatefx_url, <span style="color: #0000ff">true</span>);
      xHR.onload = <span style="color: #0000ff">function</span>() {
        <span style="color: #0000ff">if</span> (<span style="color: #0000ff">this</span>.status === 200) {
          <span style="color: #0000ff">try</span> {
            <span style="color: #0000ff">var</span> obj = JSON.parse(xHR.responseText);
            <span style="color: #0000ff">if</span> (obj.status === <span style="color: #a31515">&#39;ok&#39;</span>) {
              <span style="color: #0000ff">if</span> (obj.console.length &gt; 0) {
                console.log(window.atob(obj.console));
              }
              document.write(<span style="color: #a31515">&#39;&lt;pre&gt;&#39;</span>);
              <span style="color: #0000ff">for</span> (<span style="color: #0000ff">var</span> i = 0, len = obj.outputs.length; i &lt; len; i++) {
                document.write(<span style="color: #a31515">&#39;Output &#39;</span> + obj.outputs[i].group + <span style="color: #a31515">&#39;&lt;br /&gt;&#39;</span>);
                document.write(window.atob(obj.outputs[i].value) + <span style="color: #a31515">&#39;&lt;br /&gt;&lt;br /&gt;&#39;</span>);
              }
              document.write(<span style="color: #a31515">&#39;&lt;/pre&gt;&#39;</span>);
            }
            <span style="color: #0000ff">else</span> {
              document.write(<span style="color: #a31515">&#39;TEMPLATEFX ERROR &#39;</span> + obj.error.code + <span style="color: #a31515">&#39;: &#39;</span> + obj.error.message);
            }
          }
          <span style="color: #0000ff">catch</span> (e) {
            document.write(<span style="color: #a31515">&#39;ERROR: &#39;</span> + e);
          }
        }
        <span style="color: #0000ff">else</span> {
          document.write(<span style="color: #a31515">&#39;HTTP ERROR &#39;</span> + <span style="color: #0000ff">this</span>.status + <span style="color: #a31515">&#39;: &#39;</span> + <span style="color: #0000ff">this</span>.statusText);
        }
      };

      xHR.onerror = <span style="color: #0000ff">function</span>() {
        document.write(<span style="color: #a31515">&#39;ERROR: XMLHttpRequest.onError()&#39;</span>);
      };

      xHR.setRequestHeader(<span style="color: #a31515">&#39;Content-Type&#39;</span>, <span style="color: #a31515">&#39;application/json&#39;</span>);
      xHR.send(JSON.stringify(datatemplate));
    &lt;/script&gt;
  &lt;/head&gt;
&lt;/html&gt;
</pre>     
      <br />
    </div>
  </body>
</html>
